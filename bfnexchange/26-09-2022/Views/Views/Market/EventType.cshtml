@model IEnumerable<bfnexchange.Models.EventType>

<div id="maineventtypediv" class="col-md-12 no-padding">


    <ul class="nav maincategory-sports">
        <li class="dropdown-submenu">
            <a id="sportsitem1" onclick="ShowAllMatches()">Sports</a>

            <ul id="allsportsul" class="nav dropdown-menu eventtypesinplay"></ul>
        </li>
        <li class="dropdown-submenu">
            <a id="sportsitem2" onclick="ShowInPlay()">In-Play Events</a>
            <ul id="inplayul" class="nav dropdown-menu eventtypesinplay"></ul>
        </li>
        @if (LoggedinUserDetail.isAllowedHorseRacing() == true)
        {
            <li class="dropdown-submenu">
                <a id="sportsitem3" onclick="ShowTodayHorseRace()">Horse Racing -Today's Card </a>
                <ul id="todayhorseraceui" class="nav dropdown-menu eventtypestodayhorserace"></ul>
            </li>
        }
        @if (LoggedinUserDetail.isAllowedGrayHoundRacing() == true)
        {
            <li class="dropdown-submenu">
                <a id="sportsitem4" onclick="ShowTodayGrayhoundRace()">Greyhound Racing -Today's Card </a>
                <ul id="todaygrayhoundraceui" class="nav dropdown-menu eventtypestodayGreyhoundrace"></ul>
            </li>
			
		}
    </ul>
</div>

<div class="col-md-12 no-padding  col-sm-12">
    <div class="col-md-12 no-padding">
        <div id="marketbook">
            @*<ul id="marketbooksul"></ul>
                <div class="mareketbooks">

                </div>*@

        </div>
        <div id="marketbookTWT">

        </div>
    </div>
</div>
<div class="col-md-12 no-padding  col-sm-12">
    <div class="col-md-12 no-padding">
        <div id="fancymarketbook">


        </div>
    </div>
</div>
<div id="mainuserbetdiv" class="col-md-12 no-padding">
    @*<div class="col-md-12 no-padding">
        <label style="text-decoration:underline;cursor:pointer" onclick="Toggleliabalitiesbymarkets()">Liabalities</label>
        <input type="button" onclick="Loadliabalitiesbymarkets()" class="btn btn-default refreshbutton" value="Refresh" />
    </div>
    <div id="libalitybymarket" style="display:none">

    </div>*@
	<div id="tv" >
       <input type="button" id="btnPlay" value="Play" />     
    </div>

    <div>
       	<iframe id="video"  frameborder="0" style="display:none;width:100%;height:260px" allowfullscreen></iframe>
	 </div>
    <div id="userbets">

    </div>



</div>
<div id='myModalBetslip' class='modal'>
    <div class="modal-dialog">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 id="betslipheading" class="modal-title">You are going to </h4>
        </div>
        <div id="betslipcontent" class="modal-content">
            <div id="betslip">
                <div class="col-md-12 col-sm-12 no-padding betslipselections">
                    <div class="col-md-6 col-sm-6 betslipselectionname">
                        <label>Selection</label>
                        <label id="betslipselection"></label>
                    </div>
                    <div class="col-md-3 col-sm-3 no-padding betslipodd">
                        <label>Back</label>
                        <label id="betslipback">

                        </label>
                        <label id="betslipsize" style="display:none">

                        </label>
                    </div>
                    <div class="col-md-3 col-sm-3 no-padding betslipodd">
                        <label>Lay</label>
                        <label id="betsliplay">

                        </label>

                    </div>
                </div>

                <div class="col-md-12 col-sm-12 no-padding amountarea">
                    <div class="col-md-6 no-padding">
                        <div class="amountbutton">
                            <input type="button" class="btn btn-default" value="+10000" data-value="10000" />
                            <input type="button" class="btn btn-default" value="+2000" data-value="2000" />
                            <input type="button" class="btn btn-default" value="+5000" data-value="5000" />
                            <input type="button" class="btn btn-default" value="10000" data-value="10000" />
                            <input type="button" class="btn btn-default" value="25000" data-value="25000" />
                            <input type="button" class="btn btn-default" value="50000" data-value="50000" />
                            <input type="button" class="btn btn-default" value="100000" data-value="100000" />
                            <input type="button" class="btn btn-default" value="20000" data-value="20000" />
                            <input type="button" class="btn btn-default" value="30000" data-value="30000" />
                            @*<input type="button" class="btn btn-default" value="500000" data-value="500000" />
                                <input type="button" class="btn btn-default" value="+25000" data-value="25000" />
                                <input type="button" class="btn btn-default" value="+50000" data-value="50000" />
                                <input type="button" class="btn btn-default" value="+100000" data-value="100000" />
                                <input type="button" class="btn btn-default" value="+200000" data-value="200000" />
                                <input type="button" class="btn btn-default" value="+300000" data-value="300000" />
                                <input type="button" class="btn btn-default" value="+500000" data-value="500000" />
                                <input type="button" class="btn btn-default" value="+10 Lakh" data-value="1000000" />
                                <input type="button" class="btn btn-default" value="+20 Lakh" data-value="2000000" />
                                <input type="button" class="btn btn-default" value="+50 Lakh" data-value="5000000" />*@
                        </div>
                    </div>
                    <div class="col-md-6 no-padding">
                        <div class="col-md-12 no-padding">
                            <div class="amounts">
                                <label>Odd</label>
                                <div class="upanddown">

                                    <input id="betslipodd" onmouseup="calculateamounts()" onkeyup="calculateamounts()" type="text" />
                                    <div class="plusminus">
                                        <span class="glyphicon glyphicon-chevron-up" onclick="increment();"></span>
                                        <span class="glyphicon glyphicon-chevron-down" onclick="decrement();"></span>

                                    </div>

                                </div>

                                <label id="betslipoddlabel"></label>
                            </div>
                            <div class="amounts">
                                <label>Amount</label>
                                <input type="number" onmouseup="calculateamounts()" min="500" max="5000000000" step="1" id="betslipamount" onkeyup="calculateamounts()" />
                                <label id="betslipamountlabel"></label>
                            </div>
                            <div class="betslipbuttonssubmit">

                                <input type="button" class="btn btn-default" data-dismiss="modal" value="Close" id="btnBetslipClose" />
                                <input type="button" class="btn btn-default" value="Reset" onclick="resetamount()" id="btnBetslipReset" />
                                <input type="button" class="btn btn-default" value="Submit" id="btnBetslipsubmit" />
                            </div>
                        </div>
                        <div class="col-md-12 loadingimg no-padding">
                            <img src="~/Content/Images/default2.gif" />
                        </div>

                    </div>
                </div>
            </div>


        </div>

    </div>

</div>
<div id='myModalBetslipmultiple' class='modal'>
    <div class="modal-dialog">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 id="betslipheadingmultiple" class="modal-title">You are going to place </h4>
        </div>
        <div id="betslipcontentmultiple" class="modal-content">
            <div id="betslipmultiple">
                <div class="col-md-12 no-padding betslipselections">
                    <div class="col-md-6 no-padding">

                        <div class="col-md-12 no-padding">
                            <div class="col-md-6 betslipselectionname">
                                <label>Selection</label>

                            </div>
                            <div class="col-md-3 no-padding betslipodd">
                                <label>Back</label>






                            </div>
                            <div class="col-md-3 no-padding betslipodd">
                                <label>Lay</label>


                            </div>
                        </div>
                        <div id="betslipmultiplerunners" class="col-md-12 no-padding">

                        </div>
                    </div>
                    <div class="col-md-6 no-padding">
                        <div class="col-md-12 no-padding amountarea">
                            <div class="col-md-12 no-padding">
                                <div class="amountbuttonmultiple">
                                    <input type="button" class="btn btn-default" value="+1000" data-value="1000" />
                                    <input type="button" class="btn btn-default" value="+2000" data-value="2000" />
                                    <input type="button" class="btn btn-default" value="+5000" data-value="5000" />
                                    <input type="button" class="btn btn-default" value="10000" data-value="10000" />
                                    <input type="button" class="btn btn-default" value="25000" data-value="25000" />
                                    <input type="button" class="btn btn-default" value="50000" data-value="50000" />
                                    <input type="button" class="btn btn-default" value="100000" data-value="100000" />
                                    <input type="button" class="btn btn-default" value="20000" data-value="20000" />
                                    <input type="button" class="btn btn-default" value="30000" data-value="30000" />


                                    @*<input type="button" class="btn btn-default" value="2000" data-value="2000" />
                                        <input type="button" class="btn btn-default" value="5000" data-value="5000" />
                                        <input type="button" class="btn btn-default" value="10000" data-value="10000" />
                                        <input type="button" class="btn btn-default" value="20000" data-value="20000" />
                                        <input type="button" class="btn btn-default" value="25000" data-value="25000" />
                                        <input type="button" class="btn btn-default" value="50000" data-value="50000" />
                                        <input type="button" class="btn btn-default" value="100000" data-value="100000" />
                                        <input type="button" class="btn btn-default" value="200000" data-value="200000" />
                                        <input type="button" class="btn btn-default" value="500000" data-value="500000" />
                                        <input type="button" class="btn btn-default" value="+25000" data-value="25000" />
                                        <input type="button" class="btn btn-default" value="+50000" data-value="50000" />
                                        <input type="button" class="btn btn-default" value="+100000" data-value="100000" />
                                        <input type="button" class="btn btn-default" value="+200000" data-value="200000" />
                                        <input type="button" class="btn btn-default" value="+300000" data-value="300000" />
                                        <input type="button" class="btn btn-default" value="+500000" data-value="500000" />
                                        <input type="button" class="btn btn-default" value="+10 Lakh" data-value="1000000" />
                                        <input type="button" class="btn btn-default" value="+20 Lakh" data-value="2000000" />
                                        <input type="button" class="btn btn-default" value="+50 Lakh" data-value="5000000" />*@
                                </div>
                            </div>
                            <div class="col-md-12 no-padding ">
                                <div class="col-md-12 no-padding">
                                    <div class="amounts" style="margin-top:10px">

                                        <label id="betslipbackmultiple"></label>
                                        <label id="betsliplaymultiple"></label>

                                    </div>

                                    <div class="amounts">
                                        <label>Amount</label>
                                        <input type="number" onmouseup="calculateamountsmultiple()" min="2000" max="5000000000" step="1" id="betslipamountmultiple" onkeyup="calculateamountsmultiple()" />

                                    </div>
                                    <div class="amounts">
                                        <label id="betslipoddlabelmultiple"></label>
                                        <label id="betslipamountlabelmultiple"></label>
                                    </div>
                                    <div class="amounts">

                                        <input type="button" class="btn btn-default" data-dismiss="modal" value="Close" id="btnBetslipClosemultiple" />
                                        <input type="button" class="btn btn-default" value="Reset" onclick="resetamountmultiple()" id="btnBetslipResetmultiple" />
                                        <input type="button" class="btn btn-default" value="Submit" id="btnBetslipsubmitmultiple" />
                                    </div>
                                </div>
                                <div class="col-md-12 loadingimg no-padding">
                                    <label>Please wait....</label>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

    </div>

</div>
<div id='myModalFancy' class='modal'>
    <div class="modal-dialog">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Market Rules</h4>
        </div>
        <div id="rulescontent" class="modal-content">

        </div>
    </div>
</div>
<div id="cdialog" title="Confirmation Required">
    Are you sure about this?
</div>
<input type="hidden" id="openedbetslipid" value="" />
<input type="hidden" id="lastsavedhtml" value="" />
<input type="hidden" id="lastsavedhtmlTWT" value="" />
<input type="hidden" id="betsliptype" value="" />
<input type="hidden" id="isBetSlipEdit" value="0" />
<input type="hidden" id="lastloadedmarket" value="" />
<input type="hidden" id="lastloadedmarketTWT" value="" />
<input type="hidden" id="loadedmarketbook" value="" />
<input type="hidden" id="loadedmarketbookname" value="" />
<input type="hidden" id="loadedbetlocation" value="" />
<input type="hidden" id="clickedodd" value="" />
<input type="hidden" id="clickedlocation" value="" />
<input type="hidden" id="clickedbetsize" value="" />
<input type="hidden" id="clickedID" value="0" />
<input type="hidden" id="activesheetname" value="" />

<script type="text/javascript">
    function  showmarketrules(category,marketbookname,runnerscount) {

        dataurl = '/DashBoard/GetRulesbyMarketnameandCategory';

        $.ajax({
            url: dataurl,

            type: 'GET',
            async:false,
            data: { 'categoryname': category,'marketbookname': marketbookname,'Runnerscount':runnerscount },

            complete: function () {

            },
            success: function (data) {
                $("#rulescontent").html(data);
                $('#myModalFancy').modal('show');
            }
        });
    }
    function LoadVideo(){

        $("#showvideo").click(function () {
            $("#video1").attr("src", "https://livemediasystem.com/bf/c2.html");
        });
    }
function refreshliabalityandbalance(){
        dataurl = '/UserBet/GetTotalLiabality';

        $.ajax({
            url: dataurl,

            type: 'GET',
            async:false,
            complete: function () {

            },
            success: function (data) {
                debugger;
                var dataarr=data.split("|");
                var currentliablity = "Current Liabality: 0";
                var Totliablity = "Total Liabality: " + dataarr[2];
           
                var currentbalance = dataarr[0];
                var newbalance = parseInt(currentbalance) + parseInt(dataarr[2]);
                $("#CurrentUserBalance").html("Balance: " + newbalance.toString());
 $("#CurrentUserLiabality").html(currentliablity);
                $("#TotalLiabality").html(Totliablity);
            }
        });
    }
    function togglemainsportsmenu(num,fromclick){
        fromclicklocation=fromclick;
        if(num==1){
            $(".usernameandliablity").show();
            $(".maincategory-sports").hide();
            $("#partialviews").hide();
            $("#libalitybymarket").hide();
 refreshliabalityandbalance();
        }
        if(num==2){
            $("#libalitybymarket").hide();
            if($(".maincategory-sports").length==0 && fromclick=="footer"){
                LoadMarketView('MarketView');
            }
            if(fromclick=="footer"){
                {
                    $(".maincategory-sports").show();
                    $(".usernameandliablity").hide();
                    $("#partialviews").hide();

                }

            }

        }
        if(num==3){

            if($(".maincategory-sports").length==0 && fromclick=="footer"){
                LoadMarketView('MarketView');
            }
            $("#partialviews").show();
            $(".maincategory-sports").hide();
            $(".usernameandliablity").hide();
            $(".fullscorecard").hide();
            $("#marketbookdataforshow").show();
            $("#mainuserbetdiv").show();
            $("#libalitybymarket").hide();
            
        }
        if(num==4){
            $(".fullscorecard").show();
            $("#marketbookdataforshow").hide();
            $("#mainuserbetdiv").hide();
            $("#libalitybymarket").hide();
            $("#partialviews").show();
        }
        if(num==5){
            $("#libalitybymarket").show();
            $(".usernameandliablity").hide();
            $("#partialviews").hide();
            $(".maincategory-sports").hide();
            Loadliabalitiesbymarkets();
        }

    }
    function increment(){
        var input = document.getElementById('betslipodd');

        if(parseFloat(input.value) >1 && parseFloat(input.value)<=1000){

            if(parseFloat(input.value)>1 && parseFloat(input.value)<2){
                input.value = parseFloat(input.value) + 0.01;
            }
            if(parseFloat(input.value)>=2 && parseFloat(input.value)<3){
                input.value = parseFloat(input.value) + 0.02;
            }
            if(parseFloat(input.value)>=3 && parseFloat(input.value)<4){
                input.value = parseFloat(input.value) + 0.05;
            }
            if(parseFloat(input.value)>=4 && parseFloat(input.value)<5){
                input.value = parseFloat(input.value) + 0.10;
            }
            if(parseFloat(input.value)>=5 && parseFloat(input.value)<6){
                input.value = parseFloat(input.value) + 0.20;
            }
            if(parseFloat(input.value)>=6 && parseFloat(input.value)<10){
                input.value = parseFloat(input.value) + 0.20;
            }
            if(parseFloat(input.value)>=10 && parseFloat(input.value)<20){
                input.value = parseFloat(input.value) + 0.50;
            }
            if(parseFloat(input.value)>=20 && parseFloat(input.value)<30){
                input.value = parseFloat(input.value) + 1;
            }
            if(parseFloat(input.value)>=30 && parseFloat(input.value)<50){
                input.value = parseFloat(input.value) + 2;
            }
            if(parseFloat(input.value)>=50 && parseFloat(input.value)<100){
                input.value = parseFloat(input.value) + 5;
            }
            if(parseFloat(input.value)>=100 && parseFloat(input.value)<=1000){
                input.value = parseFloat(input.value) + 10;
            }
            input.value = parseFloat(input.value).toFixed(2);
        }
        calculateamounts();

    }

    function decrement(){
        var input = document.getElementById('betslipodd');
        if(parseFloat(input.value) >1 && parseFloat(input.value)<=1000){


            if(parseFloat(input.value)>1 && parseFloat(input.value)<2){
                input.value = parseFloat(input.value) - 0.01;
            }
            if(parseFloat(input.value)>=2 && parseFloat(input.value)<3){
                input.value = parseFloat(input.value) - 0.02;
            }
            if(parseFloat(input.value)>=3 && parseFloat(input.value)<4){
                input.value = parseFloat(input.value)- 0.05;
            }
            if(parseFloat(input.value)>=4 && parseFloat(input.value)<5){
                input.value = parseFloat(input.value) - 0.10;
            }
            if(parseFloat(input.value)>=5 && parseFloat(input.value)<6){
                input.value = parseFloat(input.value) - 0.20;
            }
            if(parseFloat(input.value)>=6 && parseFloat(input.value)<10){
                input.value = parseFloat(input.value) - 0.20;
            }
            if(parseFloat(input.value)>=10 && parseFloat(input.value)<20){
                input.value = parseFloat(input.value) - 0.50;
            }
            if(parseFloat(input.value)>=20 && parseFloat(input.value)<30){
                input.value = parseFloat(input.value) - 1;
            }
            if(parseFloat(input.value)>=30 && parseFloat(input.value)<50){
                input.value = parseFloat(input.value) - 2;
            }
            if(parseFloat(input.value)>=50 && parseFloat(input.value)<100){
                input.value = parseFloat(input.value) - 5;
            }
            if(parseFloat(input.value)>=100 && parseFloat(input.value)<=1000){
                input.value = parseFloat(input.value) - 10;
            }
            input.value = parseFloat(input.value).toFixed(2);
        }
        calculateamounts();
    }
    var parentID = "0";
    function ShowInPlay() {
        $("#todayhorseraceui").hide();

        $("#todaygrayhoundraceui").hide();
        $("#allsportsul").hide();

        if ($("#inplayul").css("display") == "none") {
            ShowLoader();
            dataurl = '/Market/InPlayMatches';
            $.ajax({
                url: dataurl,

                type: 'GET',



                complete: function () {

                },
                success: function (data) {
                    HideLoader();
                    $("#inplayul").html(data);
                    $("#inplayul").show();
                    $(".eventtypes").hide();

                }
            });
        }
        else {
            $("#inplayul").hide();
        }
    }
    function ShowAllMatches() {
        $("#todayhorseraceui").hide();

        $("#todaygrayhoundraceui").hide();
        $("#inplayul").hide();

        if ($("#allsportsul").css("display") == "none") {
            ShowLoader();
            dataurl = '/Market/AllMatches';
            $.ajax({
                url: dataurl,

                type: 'GET',



                complete: function () {

                },
                success: function (data) {
                    HideLoader();
                    $("#allsportsul").html(data);
                    $("#allsportsul").show();
                    $(".eventtypes").hide();

                }
            });
        }
        else {
            $("#allsportsul").hide();
        }
    }
    function ShowTodayHorseRace() {

        $("#inplayul").hide();
        $("#todaygrayhoundraceui").hide();
        $("#allsportsul").hide();
        if ($("#todayhorseraceui").css("display") == "none") {
            ShowLoader();
            dataurl = '/Market/TodayHorseRacing';
            $.ajax({
                url: dataurl,

                type: 'GET',



                complete: function () {

                },
                success: function (data) {
                    HideLoader();
                    $("#todayhorseraceui").html(data);
                    $("#todayhorseraceui").show();


                }
            });
        }
        else {
            $("#todayhorseraceui").hide();
        }
    }
    function ShowTodayGrayhoundRace() {
        $("#todayhorseraceui").hide();
        $("#inplayul").hide();
        $("#allsportsul").hide();
        if ($("#todaygrayhoundraceui").css("display") == "none") {
            ShowLoader();
            dataurl = '/Market/TodayGreyHoundRacing';
            $.ajax({
                url: dataurl,

                type: 'GET',



                complete: function () {

                },
                success: function (data) {
                    HideLoader();
                    $("#todaygrayhoundraceui").html(data);
                    $("#todaygrayhoundraceui").show();
                    $("#todayhorseraceui").hide();


                }
            });
        }
        else {
            $("#todaygrayhoundraceui").hide();
        }
    }
    function deleteuserbet(ID) {
        var categoryname=$("#marketbookCategory"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        if (categoryname.indexOf("Cricket")>=0 )
        {
            setTimeout(function(){
                var userbetsIDs = [];
                userbetsIDs.push(ID);
                dataurl = '/UserBet/UpdateUnMatchedStatustoComplete';

                $.ajax({
                    url: dataurl,

                    type: 'POST',
                    async:false,
                    data: { 'userbetsIDs': userbetsIDs },

                    complete: function () {

                    },
                    success: function (data) {
                        //   LoadUserBets();
                    }
                });

            },@LoggedinUserDetail.BetPlaceWaitandInterval.CancelBetTime.Value);

        }
        else{
            setTimeout(function(){
                var userbetsIDs = [];
                userbetsIDs.push(ID);
                dataurl = '/UserBet/UpdateUnMatchedStatustoComplete';

                $.ajax({
                    url: dataurl,

                    type: 'POST',
                    async:false,
                    data: { 'userbetsIDs': userbetsIDs },

                    complete: function () {

                    },
                    success: function (data) {
                        //   LoadUserBets();
                    }
                });

            },0);
        }


    }
    function SetFirstItemActive(id) {

        $(".marketbooksul li").removeClass("active");
        $(".tab-content .tab-pane").removeClass("active");
        if (id == "") {
            $(".nav-tabs li:first").addClass("active");
            $(".tab-content .tab-pane:first").addClass("active");

        }
        else {
            var old = id.toString();
            var newid = old.replace('.', '');
            setTimeout(function () {
                $("#marketbook" + newid + "li").addClass("active");
                $("#marketbook" + newid).addClass("active");
            }, 100);

            $("#activesheetname").val($("#marketbooksheet"+ newid).val());
        }

    }
    function deletetab(id) {

        var old = id.toString();
        var newid = old.replace('.', '');
        $("#marketbook" + newid + "li").remove();
        $("#marketbook" + newid).remove();
        $("#fancymarketbook").html("");
        $.ajax({
            url: '/Market/SetMarketClosedbyUser',
            data: { 'marketbookID': id },
            async: false,
            success: function (data) {

                if($(".nav-tabs li").length==0){
                    $("#lastloadedmarket").val("");
                }
                else{
                    $("#lastloadedmarket").val($(".nav-tabs li:last").attr("data-value"));
                }


                //SetFirstItemActive($(".nav-tabs li:last").attr("data-value"));
                //$(".nav-tabs li:last").addClass("active");
                //$(".tab-content .tab-pane:last").addClass("active");



            }
        });

    }
    function LoadUserBetsforAgent() {
        $.ajax({
            url: '/UserBet/UserBets',
            type: 'GET',

            async: true,
            complete: function () {
                LoadUserBetsforAgent();


            },
            success: function (data) {
                $("#userbets").html(data);



            }
        });
    }
    function LoadUserBets() {

        $.ajax({
            url: '/UserBet/UserBets',
            type: 'GET',

            async: true,
            complete: function () {
                //  LoadActiveMarket();

                //   LoadUserBets();
                // Loadliabalitiesbymarkets();
                @*if(@LoggedinUserDetail.GetUserTypeID()!=3){


                }*@

                @*if(@LoggedinUserDetail.GetUserTypeID()!=3){
                    LoadActiveMarket();
                }
                else{
                    LoadMarketType("");
                }*@


            },
            error:function(){
                LoadUserBets();
            },
            success: function (data) {

                $("#userbets").html(data);
                setTimeout(function () {
                    LoadUserBets();

                },500);



            }
        });

    }
    function ShowAverageSection(){
        if (@LoggedinUserDetail.GetUserTypeID()==1){
            $(".averagecalculations").html($("#averagecalculationDynamic"+$("#lastloadedmarket").val().toString().replace(".","")).html());
            //  $("#ddlRunners1"+$("#lastloadedmarket").val().toString().replace(".","") + " option").first().prop('selected', 'selected');;
            GetSelectedRunnersforDropdowns();
            //$("#HowYouKnow option").filter(function(index) { return $(this).text() === "GOOGLE"; }).attr('selected', 'selected');
            //
            CalculateAverageRate();
        }
    }
    function SetSelectedRunnersforDropdowns(){

        $("#averagerunner1").val( $("#ddlRunners1"+$("#lastloadedmarket").val().toString().replace(".","")).find('option:selected').text());
        $("#averagerunner2").val( $("#ddlRunners2"+$("#lastloadedmarket").val().toString().replace(".","")).find('option:selected').text());
    }
    function GetSelectedRunnersforDropdowns(){

        $("#ddlRunners1"+$("#lastloadedmarket").val().toString().replace(".","") + " option").filter(function(index) { return $(this).text() === $("#averagerunner1").val(); }).attr('selected', 'selected');
        $("#ddlRunners2"+$("#lastloadedmarket").val().toString().replace(".","") + " option").filter(function(index) { return $(this).text() === $("#averagerunner2").val(); }).attr('selected', 'selected');

    }
    function HideFancyMarket(){
        $("#marketbookFancyShown"+$("#lastloadedmarket").val().toString().replace(".","")).val("false");
    }
    function GetActiveMarketFancy(){

        var marketbbokFancyIDs=$("#marketbookFancyIDs"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var showfancypanel=  $("#marketbookFancyShown"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        if(marketbbokFancyIDs =="true" && showfancypanel=="true"){
            var marketbbokFancyIDmarkets=$("#marketbookFancyMarket"+$("#lastloadedmarket").val().toString().replace(".","")).val();

            var marketbookstatus=$("#marketbookstatus"+$("#lastloadedmarket").val().toString().replace(".","")).val();
            var orignalopendate=$("#marketbookorignalopendate"+$("#lastloadedmarket").val().toString().replace(".","")).val();
            var orignalopendate=$("#marketbookorignalopendate"+$("#lastloadedmarket").val().toString().replace(".","")).val();
            var datearr=orignalopendate.split(" ");
            var datearr2=datearr[0].split("/");

            orignalopendate=datearr2[1]+"/"+datearr2[0]+"/"+datearr2[2]+" "+datearr[1];

            $.ajax({
                url: '/Fancy/GetFancyMarket/',

                type: 'GET',
                async: true,
                data: { 'MarketBookID': $("#lastloadedmarket").val(),'EventOpendate': orignalopendate},

                complete: function () {

                },
                success: function (data) {

                    if(data !=""){

                        $("#fancymarketbook").html(data);
                        //comparemarketbook();
                        //  AssignDatatoMarketBookFancy(data);

                    }
                    LoadActiveMarketFancy();





                }

            });
        }
        else{
            $("#fancymarketbook").html("");


            $.ajax({
                url: '/Fancy/SetLinevMarketsNull/',

                type: 'GET',
                async: true,


                complete: function () {

                },
                success: function (data) {






                }

            });
        }
        $(".fancybackandlaydiv").hide();

    }
    function LoadActiveMarketFancy(){

        var marketbbokFancyIDs=$("#marketbookFancyIDs"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var showfancypanel=  $("#marketbookFancyShown"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        if(marketbbokFancyIDs =="true"  && showfancypanel=="true"){
            var marketbbokFancyIDmarkets=$("#marketbookFancyMarket"+$("#lastloadedmarket").val().toString().replace(".","")).val();

            var marketbookstatus=$("#marketbookstatus"+$("#lastloadedmarket").val().toString().replace(".","")).val();
            var orignalopendate=$("#marketbookorignalopendate"+$("#lastloadedmarket").val().toString().replace(".","")).val();
            var orignalopendate=$("#marketbookorignalopendate"+$("#lastloadedmarket").val().toString().replace(".","")).val();
            var datearr=orignalopendate.split(" ");
            var datearr2=datearr[0].split("/");

            orignalopendate=datearr2[1]+"/"+datearr2[0]+"/"+datearr2[2]+" "+datearr[1] ;

            $.ajax({
                url: '/Fancy/LoadFancyMarket/',

                type: 'GET',
                async: true,
                data: { 'MarketBookID': $("#lastloadedmarket").val(),'EventOpendate': orignalopendate},

                complete: function () {

                },
                error:function(){
                    LoadActiveMarketFancy();
                },
                success: function (data) {
                    setTimeout(function () {
                        LoadActiveMarketFancy();

                    },200);
                    if(data !=""){

                        //  $("#fancymarketbook").html(data);
                        //comparemarketbook();
                        AssignDatatoMarketBookFancy(data);

                    }





                }

            });
        }
        else{
            $("#fancymarketbook").html("");


        }

    }
    function showcurrentteam(team) {
       
        $("#currentteamforSelection"+$("#lastloadedmarket").val().toString().replace(".","")).val(team);
        if(team=="A"){
            $("#teamaname").addClass("teamnamebtnactive");
            $("#teamaname").removeClass("teamnamebtnsimple");
            $("#teambname").addClass("teamnamebtnsimple");
            $("#teambname").removeClass("teamnamebtnactive");
        }
        else{
            $("#teambname").addClass("teamnamebtnactive");
            $("#teambname").removeClass("teamnamebtnsimple");
            $("#teamaname").addClass("teamnamebtnsimple");
            $("#teamaname").removeClass("teamnamebtnactive");
        }

       
    }
    function showcurrentviewsquadorscorecard(num){
        $("#currentview"+$("#lastloadedmarket").val().toString().replace(".","")).val(num);
      
        if(num=="0"){
            $("#teamASquadbtn").addClass("teamnamebtnactive");
            $("#teamASquadbtn").removeClass("teamnamebtnsimple");
            $("#teamAScoreCardbtn").addClass("teamnamebtnsimple");
            $("#teamAScoreCardbtn").removeClass("teamnamebtnactive");
        }
        else{
            $("#teamAScoreCardbtn").addClass("teamnamebtnactive");
            $("#teamAScoreCardbtn").removeClass("teamnamebtnsimple");
            $("#teamASquadbtn").addClass("teamnamebtnsimple");
            $("#teamASquadbtn").removeClass("teamnamebtnactive");
        }
    }
    function showfullscorecard(){
        $(".fullscorecard").show();
    }
    function AssignDataToScoreCard(matchstr){
        if(matchstr==""){
            $(".mainscorediv").hide();
            return;
        }
        var scorecard= JSON.parse(matchstr);
        if(scorecard!=null){
            $(".mainscorediv").show();
            $("#lblteamascore").text(scorecard.TeamAScore==null?"":scorecard.TeamAScore+ " Overs");
            $("#lblteambscore").text(scorecard.TeamBScore==null?"":scorecard.TeamBScore+ " Overs");
            $("#lblcurrRR").text(scorecard.CurrRR);
            $("#lblRR").text(scorecard.ReqRR=="Req RR:"?"":scorecard.ReqRR);
            if(scorecard.RequireScore!=null){
                $("#lblRequirescore").show();
              
                var scorearr=scorecard.RequireScore.split(".");
                $("#lblRequirescore").text(scorearr[0]);
            }
            else{
                $("#lblRequirescore").hide();
              
            }
            if(scorecard.TeamBScore!=null){
               
                $("#lblteambscore").show();
              
            }
            else{
               
                $("#lblteambscore").hide();
            }
           
            if (scorecard.Msgs != null)
            {
               
                if (scorecard.Msgs.completed != null)
                {
                    $("#lblMatchStatus").show();
                    $("#lblMatchStatus").text(scorecard.Msgs.completed);
                }
                else
                {
                    if (scorecard.Msgs.match_comments != null)
                    {
                        $("#lblMatchStatus").show();
                        $("#lblMatchStatus").text(scorecard.Msgs.match_comments);
                    }
                    else{
                        $("#lblMatchStatus").hide();
                    }
                }
            }
            else
            {
                $("#lblMatchStatus").hide();
            }
           
            
            $("#teamaname").text(scorecard.Teams[0].TeamName); 
            $("#teambname").text(scorecard.Teams[1].TeamName); 
            if($(".fullscorecard").css("display")!="none"){
                $("#imgstricker").show();
                $("#imgbowler").show();
                $("#lblStricker").show();
                $("#lblBowler").show();
                $("#lblrecentoversstr").show();
                $("#lblLastBallComment").show();
                $("#lblStricker").text(scorecard.StrickerStr==null?"Waiting for Batsman":scorecard.StrickerStr);
                $("#lblBowler").text(scorecard.BowlerStr==null?"Waiting for Bowler":scorecard.BowlerStr);
                $("#lblrecentoversstr").text(scorecard.RecentOverBalls==null?"":"Recent: "+ scorecard.RecentOverBalls.join(". "));
                $("#lblLastBallComment").text(scorecard.LastBallComment=="Req RR:"?"":scorecard.LastBallComment);
                var dataToSend = JSON.stringify(matchstr);
                $.ajax({
                    url: '/CricketScore/CreateScoreCardWithTeams/',

                    type: 'POST',
                    async: false,
                    //dataType: "json",
                    data:JSON.stringify( { 'scorecard': scorecard,'currentteam': $("#currentteamforSelection"+$("#lastloadedmarket").val().toString().replace(".","")).val()}),
                   contentType: "application/json; charset=utf-8",
                    complete: function () {
                       
                    },
                    error:function(jqXHR, exception){
                      alert(exception);
                    },
                    success: function(data) {
                      
                       
                        $("#fullscorecarddetails").html(data);
                        if( $("#currentview"+$("#lastloadedmarket").val().toString().replace(".","")).val()=="0"){
                            $(".squadA").show();
                            $(".scorecardA").hide();
                        } 
                        else{
                            $(".squadA").hide();
                            $(".scorecardA").show();
                        }


                   



                    }

                });
            }
            else{
                $("#imgstricker").hide();
                $("#imgbowler").hide();
                $("#lblStricker").hide();
                $("#lblBowler").hide();
                $("#lblrecentoversstr").hide();
                $("#lblLastBallComment").hide();
            }

        }
    }
    
	 function updatescores()
    {

        var cricketkey=$("#marketbookcricketkey"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var status = $("#marketbookstatus"+$("#lastloadedmarket").val().toString().replace(".","")).html();
        var getupdatesfrom= $("#getmatchupdatesfrom" + $("#lastloadedmarket").val().toString().replace(".", "")).val();
        var eventID=$("#eventidfor" + $("#lastloadedmarket").val().toString().replace(".", "")).val();
        if(status!="GOING LIVE"){
            $.ajax({
                url: '/CricketScore/CreateScoreCard/',

                type: 'GET',
                async: true,
                data: { 'matchCricketAPIKey': cricketkey,'EventId':eventID,'GetMatchUpdatesFrom':getupdatesfrom},

                complete: function () {

                },
                error:function(){
                    updatescores();
                },
                success: function (data) {
                   
                    if(getupdatesfrom=="Local"){
                        $("#lblMatchStatus").hide();
                        $("#imgstricker").hide();
                        $("#imgbowler").hide();
                        $("#lblStricker").hide();
                        $("#lblBowler").hide();
                        $("#lblrecentoversstr").hide();
                        $("#lblLastBallComment").hide();
                        if(data==""){
                            $(".mainscorediv").hide();
                            return;
                        }
                        var scorecard= JSON.parse(data);
                        if(scorecard!=null){
                            $(".mainscorediv").show();
                            $("#lblteamascore").text(scorecard.TeamAScore==null?"":scorecard.TeamAScore);
                            $("#lblteambscore").text(scorecard.TeamBScore==null?"":scorecard.TeamBScore);
                           $("#lblcurrRR").text(scorecard.CurrRR);
                            $("#lblRR").text(scorecard.ReqRR==null?"":scorecard.ReqRR);
                            if(scorecard.RequireScore!=null){
                                $("#lblRequirescore").show();

                                var scorearr=scorecard.RequireScore.split(".");
                                $("#lblRequirescore").text(scorearr[0]);
                            }
                            else{
                                $("#lblRequirescore").hide();

                            }
                            if(scorecard.TeamBScore!=null){

                                $("#lblteambscore").show();

                            }
                            else{

                                $("#lblteambscore").hide();
                            }
                        }
                    }
                    else{
                        AssignDataToScoreCard(data);
                    }

                    setTimeout(function () {
                        updatescores();

                    },500);
                    // $("#matchscores").html(data);







                }

            });
        }
        else{
            setTimeout(function () {
                updatescores();

            },1000);
            $(".mainscorediv").hide();
        }
    }
    function CheckForCricketScores(){
       
        var isallowedtogetscore=$("#marketbookgetscores"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        if(isallowedtogetscore=="true"){
            $.ajax({
                url: '/CricketScore/InitializeScoreCard/',

                type: 'GET',
                async: true,
               

                complete: function () {
                       
                },
                error:function(){
                   
                },
                success: function (data) {
                   
                    $("#matchscores").html(data);
                    updatescores();


                   



                }

            });
           
        }
    }
    //ToWintheToss
    function CheckForWintTheTossMarket(){
       
        var eventid=$("#eventidfor"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        if(1==1){

            $.ajax({
                url: '/ToWinTheToss/CheckforToWintheTossMarket/',
                data:{'EventID':eventid},
                type: 'GET',
                async: true,
               

                complete: function () {
                       
                },
                error:function(){
                   
                },
                success: function (data) {
                    if(data !=""){
                        $("#marketbookTWT").show();
                        LoadMarketTypeTWT(data);
                    }
                  


                   



                }

            });
           
        }
    }
    function LoadActiveMarketTWT() {
       
        var marketstatus=$("#marketbookstatus"+$("#lastloadedmarket").val().toString().replace(".","")).text();
        if (marketstatus !="GOING LIVE"){
            $("#marketbookTWT").hide();
            return;
        }
        $("#lastsavedhtmlTWT").val($("div[data-marketid='" + $("#lastloadedmarketTWT").val() + "']").html());

        dataurl = '/Market/LoadActiveMarket/';

       

        var marketbbokname=$("#marketbookname"+$("#lastloadedmarketTWT").val().toString().replace(".","")).val();

        var orignalopendate=$("#marketbookorignalopendate"+$("#lastloadedmarketTWT").val().toString().replace(".","")).val();
        if(orignalopendate==undefined){
            HideLoader();
            return;
        }
        var datearr=orignalopendate.split(" ");
        var datearr2=datearr[0].split("/");
       orignalopendate=datearr2[1]+"/"+datearr2[0]+"/"+datearr2[2]+" "+datearr[1] ;
        // orignalopendate=datearr2[0]+"/"+datearr2[1]+"/"+datearr2[2]+" "+datearr[1] + " "+ datearr[2];
        var mainsportcat=$("#marketbookCategory"+$("#lastloadedmarketTWT").val().toString().replace(".","")).val();
        var windowsize = $(window).width();
        if(windowsize<=680){
            var heightofidv=0;
            if(mainsportcat.indexOf("Racing")<0){
                heightofidv=0;
            }

            $("#marketbook"+$("#lastloadedmarketTWT").val().toString().replace(".","")+" .runnerswrapper").each(function(){
                if($(this).attr("id")!=null){
                    heightofidv+=$(this).height();
                }


            });
            var totrunnercount=$("#marketbook"+$("#lastloadedmarketTWT").val().toString().replace(".","")+" .runnerswrapper").length;
            if(totrunnercount>2){
                heightofidv=heightofidv+(1.60* totrunnercount);
            }
            
            $("#marketbook"+$("#lastloadedmarketTWT").val().toString().replace(".","")+" .backgroundimageforSuspended").height(heightofidv);
        }
        if(marketbbokname == undefined){
            LoadUserBets();
            return;
        }
        var selectedrunners= $("#selectedrunnersforavg"+$("#lastloadedmarketTWT").val().toString().replace(".","")).val();
        $.ajax({
            url: '/Market/LoadActiveMarketTWT/',

            type: 'GET',
            async: true,
            data: { 'ID': $("#lastloadedmarketTWT").val(),'sheetname':  marketbbokname,'OrignalOpenDate': orignalopendate ,'MainSportsCategory': mainsportcat,'RunnersForAverage':selectedrunners},

            complete: function () {
               
            },
            error:function(){
                LoadActiveMarketTWT();
            },
        success: function (data) {
            setTimeout(function () {
                LoadActiveMarketTWT();

            },200);

            if(data !=""){


                AssignDatatoMarketBookTWT(data);

            }

            //   $("div[data-marketid='" + $("#lastloadedmarket").val() + "']").html(data);

            if ($("#lastsavedhtmlTWT").val().trim() == "") {
                $("#lastsavedhtmlTWT").val($("div[data-marketid='" + $("#lastloadedmarketTWT").val() + "']").html());
            }
            $(".runners").each(function () {

                var id = $(this).attr("data-value");
                //LoadRunnername(id);

                if ($("#openedbetslipid").val() == id) {

                    SetBackandlayonbetslip(id);
                }

            });


           
            comparemarketbookTWT();
          

        }

    });
    }
    //
    function LoadActiveMarket() {

        $("#lastsavedhtml").val($("div[data-marketid='" + $("#lastloadedmarket").val() + "']").html());

        dataurl = '/Market/LoadActiveMarket/';

        if ($("#lastloadedmarket").val()==""){
            LoadUserBets();
            return;
        }

        var marketbbokname=$("#marketbookname"+$("#lastloadedmarket").val().toString().replace(".","")).val();

        var orignalopendate=$("#marketbookorignalopendate"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        if(orignalopendate==undefined){
            HideLoader();
            return;
        }
        var datearr=orignalopendate.split(" ");
        var datearr2=datearr[0].split("/");
  orignalopendate=datearr2[1]+"/"+datearr2[0]+"/"+datearr2[2]+" "+datearr[1] ;
        //orignalopendate=datearr2[0]+"/"+datearr2[1]+"/"+datearr2[2]+" "+datearr[1] + " "+ datearr[2];
        var mainsportcat=$("#marketbookCategory"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var windowsize = $(window).width();
        if(windowsize<=680){
            var heightofidv=0;
            if(mainsportcat.indexOf("Racing")<0){
                heightofidv=0;
            }

            $("#marketbook"+$("#lastloadedmarket").val().toString().replace(".","")+" .runnerswrapper").each(function(){
                if($(this).attr("id")!=null){
                    heightofidv+=$(this).height();
                }


            });
            var totrunnercount=$("#marketbook"+$("#lastloadedmarket").val().toString().replace(".","")+" .runnerswrapper").length;
            if(totrunnercount>2){
                heightofidv=heightofidv+(1.60* totrunnercount);
            }
            
            $("#marketbook"+$("#lastloadedmarket").val().toString().replace(".","")+" .backgroundimageforSuspended").height(heightofidv);
        }
        if(marketbbokname == undefined){
            LoadUserBets();
            return;
        }
 var selectedrunners= $("#selectedrunnersforavg"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        $.ajax({
            url: '/Market/LoadActiveMarket/',

            type: 'GET',
            async: true,
            data: { 'ID': $("#lastloadedmarket").val(),'sheetname':  marketbbokname,'OrignalOpenDate': orignalopendate ,'MainSportsCategory': mainsportcat,'RunnersForAverage':selectedrunners},

            complete: function () {
                // LoadUserBets();
                //  LoadActiveMarket();
                @*if(@LoggedinUserDetail.GetUserTypeID()!=3){

                    LoadUserBets();
                }
                else{
                    LoadActiveMarket();
                }*@


            },
            error:function(){
                LoadActiveMarket();
            },
            success: function (data) {
                setTimeout(function () {
                    LoadActiveMarket();

                },200);

                if(data !=""){


                    AssignDatatoMarketBook(data);

                }

                //   $("div[data-marketid='" + $("#lastloadedmarket").val() + "']").html(data);

                if ($("#lastsavedhtml").val().trim() == "") {
                    $("#lastsavedhtml").val($("div[data-marketid='" + $("#lastloadedmarket").val() + "']").html());
                }
                $(".runners").each(function () {

                    var id = $(this).attr("data-value");
                    //LoadRunnername(id);

                    if ($("#openedbetslipid").val() == id) {

                        SetBackandlayonbetslip(id);
                    }

                });


                SetSelectedRunners();
                comparemarketbook();
                @*if (@LoggedinUserDetail.GetUserTypeID() !=3 ){
                    if($("#totalmarketsopened").val() != $("#totalmarketsopened"+$("#lastloadedmarket").val().toString().replace(".","")).val()){

                        LoadMarketType("");
                    }
                }*@
                if (@LoggedinUserDetail.GetUserTypeID()==1){
                    CalculateAverageRate();

                }

                if(data !=""){
                    //   SetFirstItemActive($("#lastloadedmarket").val());


                    // LoadActiveMarket();

                }



            }

        });
    }
    function Toggleliabalitiesbymarkets(){
        if($("#libalitybymarket").css("display")=="none"){
            $("#libalitybymarket").show();
            Loadliabalitiesbymarkets();
        }
        else{
            $("#libalitybymarket").hide();
        }
    }
    function AssignDatatoMarketBook(marketbooks){

        var marketbook1= JSON.parse(marketbooks);
        var marketbook=marketbook1[0];
        var marketbookID=$("#lastloadedmarket").val().toString().replace(".","");

        if($("#lastloadedmarket").val().toString() != marketbook.MarketId){
            return;
        }
		
		if(marketbook.MarketBookName.indexOf("To Be Placed")>=0){
            $("#lblTobePlaced").text(marketbook.NumberOfWinners.toString() +" - TO BE PLACED");
        }
        $("#totalmarketsopened"+marketbookID).val(marketbook.marketsopened);

        $("#marketbookTotalMatched"+marketbookID).val(marketbook.TotalMatched.toString());
        for(j=0;j<=marketbook.Runners.length-1;j++){

            for (i = 2; i >= 0; i--)
            {
                if (marketbook.Runners[j].ExchangePrices.AvailableToBack.length - 1 >= i && marketbook.Runners[j].ExchangePrices.AvailableToBack.length > 0)
                {

                    $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price );
                    $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','back','" + marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size+"','"+ i +"','0')");
                    $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size);
                    $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','back','" + marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size+"','"+ i +"','0')");
                }
                else{
                    $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                    $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                    $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                    $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                }
            }
            for (i = 0; i < 3; i++)
            {
                if (marketbook.Runners[j].ExchangePrices.AvailableToLay.length > i && marketbook.Runners[j].ExchangePrices.AvailableToLay.length > 0)
                {

                    $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price);
                    $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','lay','" + marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size+"','"+ i +"','0')");
                    $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size);
                    $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','lay','" + marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size+"','"+ i +"','0')");
                }
                else{
                    $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                    $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                    $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                    $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                }
            }
            $("#marketbook"+marketbookID+" #lblrunnerlastprice"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].LastPriceTraded);
            $("#marketbook"+marketbookID+" #runnernamediv"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnerfavorite");
            if(marketbook.Runners[j].StatusStr=="WINNER"){

                $("#marketbook"+marketbookID+" #runnernamediv"+marketbook.Runners[j].SelectionId.toString()).addClass("runnerwinner");
                $("#marketbook"+marketbookID+" #lblSelectionName"+marketbook.Runners[j].SelectionId.toString()).attr('style', 'color: white !important');
				$("#marketbook"+marketbookID+" #lbljockey"+marketbook.Runners[j].SelectionId.toString()).attr('style', 'color: white !important');
                
				$("#lblfavoritename"+marketbookID).text($("#marketbook"+marketbookID+" #lblSelectionName"+marketbook.FavoriteID).text().toString().trim());
            }
            else{
                if (marketbook.MarketStatusstr != "Closed"){
                    $("#lblfavoritename"+marketbookID).text($("#marketbook"+marketbookID+" #lblSelectionName"+marketbook.FavoriteID).text().toString().trim());
                }
            }

            if(marketbook.FavoriteID.toString()==marketbook.Runners[j].SelectionId.toString() && marketbook.Runners[j].StatusStr!="WINNER")
            {
                $("#marketbook"+marketbookID+" #runnernamediv"+marketbook.Runners[j].SelectionId.toString()).addClass("runnerfavorite");

            }
            if(parseInt(marketbook.Runners[j].ProfitandLoss)>=0){
                $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossgreen");
                $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossred");
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersaveragegreen");
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersaveragered");
            
            }
            else{
                $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossred");
                $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossgreen");
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersaveragered");
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersaveragegreen");
            }
            if(parseInt(marketbook.Runners[j].Loss)>=0){
                $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossgreen");
                $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossred");
            }
            else{
                $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossred");
                $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossgreen");
            }
            if(marketbook.Runners[j].Average==null){
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).text("");
            }
            else{
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].Average);
            }
            $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ProfitandLoss);
            $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].Loss);


        }
        if (marketbook.MarketStatusstr == "In Play")
        {
            $("#marketbookstatus"+marketbookID).text("IN-PLAY");
            $("#marketbookstatus"+marketbookID).removeClass("suspended");
            $("#marketbookstatus"+marketbookID).removeClass("completed");

            $("#marketbookstatus"+marketbookID).removeClass("active1");
            $("#marketbookstatus"+marketbookID).addClass("inplay");
            $(".backgroundimageforSuspended").removeClass("backgroundsuspended");
            $(".backgroundimageforSuspended").removeClass("backgroundclosed");
            $(".backgroundimageforSuspended").css({"display": "none"});

        }
        else
        {
            if (marketbook.MarketStatusstr == "Suspended")
            {  $('#myModalBetslipmultiple').modal('hide');
            $('#myModalBetslip').modal('hide');
                $(".backgroundimageforSuspended").addClass("backgroundsuspended");
                if($("#marketbook"+marketbookID+ " .tobeplacedcount").height()==null){
                    $(".backgroundimageforSuspended").css({"margin-top":"47px"});
                }
                else{
                    $(".backgroundimageforSuspended").css({"margin-top":"47px"});
                }
                //  $(".backgroundimageforSuspended label").text("Suspended");
                $(".backgroundimageforSuspended").removeClass("backgroundclosed");

                $("#marketbookstatus"+marketbookID).text("SUSPENDED");
                $("#marketbookstatus"+marketbookID).removeClass("inplay");
                $("#marketbookstatus"+marketbookID).removeClass("completed");
                $("#marketbookstatus"+marketbookID).removeClass("active1");
                $("#marketbookstatus"+marketbookID).addClass("suspended");
                $(".backgroundimageforSuspended").css({"display": "block"});
            }
            else
            { if (marketbook.MarketStatusstr == "Active")
            {
                $("#marketbookstatus"+marketbookID).text("GOING LIVE");
                $("#marketbookstatus"+marketbookID).removeClass("inplay");
                $("#marketbookstatus"+marketbookID).removeClass("completed");
                $("#marketbookstatus"+marketbookID).removeClass("suspended");
                $("#marketbookstatus"+marketbookID).addClass("active1");
                $(".backgroundimageforSuspended").removeClass("backgroundsuspended");
                $(".backgroundimageforSuspended").removeClass("backgroundclosed");
                $(".backgroundimageforSuspended").css({"display": "none"});

            }
            else{
                $('#myModalBetslipmultiple').modal('hide');
                $('#myModalBetslip').modal('hide');
                $(".backgroundimageforSuspended").removeClass("backgroundsuspended");
                if($("#marketbook"+marketbookID+" .tobeplacedcount").height()==null){
                    $(".backgroundimageforSuspended").css({"margin-top":"47px"});
                }
                else{
                    $(".backgroundimageforSuspended").css({"margin-top":"47px"});
                }
                $(".backgroundimageforSuspended").addClass("backgroundclosed");
                // $(".backgroundimageforSuspended label").text("Closed");
                $("#marketbookstatus"+marketbookID).text("CLOSED");
                $("#marketbookstatus"+marketbookID).removeClass("inplay");
                $("#marketbookstatus"+marketbookID).removeClass("suspended");
                $("#marketbookstatus"+marketbookID).removeClass("active1");
                $("#marketbookstatus"+marketbookID).addClass("completed");
                $(".backgroundimageforSuspended").css({"display": "block"});
            }


            }
        }
        $("#marketbook"+marketbookID+" #lblSelectionName"+marketbook.FavoriteID).text().toString().trim();
        $("#lblfavoritename"+marketbookID).text($("#marketbook"+marketbookID+" #lblSelectionName"+marketbook.FavoriteID).text().toString().trim());

        $("#lblfavoritebackprice"+marketbookID).text(marketbook.FavoriteBack=="0"?"":marketbook.FavoriteBack);
        $("#lblfavoritebackprice"+marketbookID).attr("onclick","showbetslipmultiple('"+marketbook.FavoriteID +"','back','" + marketbook.FavoriteBack + 1 + "','4000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.FavoriteBackSize+"','0')");
        $("#lblfavoritelayprice"+marketbookID).text(marketbook.FavoriteLay=="0"?"":marketbook.FavoriteLay);
        $("#lblfavoritelayprice"+marketbookID).attr("onclick","showbetslipmultiple('"+marketbook.FavoriteID +"','lay','" + marketbook.FavoriteLay + 1 + "','4000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.FavoriteLaySize+"','0')");
        $("#lblfavoritebacksize"+marketbookID).text(marketbook.FavoriteBackSize=="0"?"":marketbook.FavoriteBackSize);
        $("#lblfavoritebacksize"+marketbookID).attr("onclick","showbetslipmultiple('"+marketbook.FavoriteID +"','back','" + marketbook.FavoriteBack + 1 + "','4000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.FavoriteBackSize+"','0')");
        $("#lblfavoritelaysize"+marketbookID).text(marketbook.FavoriteLaySize=="0"?"":marketbook.FavoriteLaySize);
        $("#lblfavoritelaysize"+marketbookID).attr("onclick","showbetslipmultiple('"+marketbook.FavoriteID +"','lay','" + marketbook.FavoriteLay + 1 + "','4000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.FavoriteLaySize+"','0')");

        $("#lbltimer"+marketbookID).text(marketbook.OpenDate);
		if(marketbook.OpenDate.toString().indexOf("-")>=0){
  $("#lbltimer"+marketbookID).attr('style', 'color: red !important');
}
    }
    function AssignDatatoMarketBookTWT(marketbooks){

        var marketbook1= JSON.parse(marketbooks);
        var marketbook=marketbook1[0];
        var marketbookID=$("#lastloadedmarketTWT").val().toString().replace(".","");

        if($("#lastloadedmarketTWT").val().toString() != marketbook.MarketId){
            return;
        }
		
       
        

      
        for(j=0;j<=marketbook.Runners.length-1;j++){

            for (i = 2; i >= 0; i--)
            {
                if (marketbook.Runners[j].ExchangePrices.AvailableToBack.length - 1 >= i && marketbook.Runners[j].ExchangePrices.AvailableToBack.length > 0)
                {

                    $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price );
                    $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','back','" + marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size+"','"+ i +"','0')");
                    $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size);
                    $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','back','" + marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size+"','"+ i +"','0')");
                }
                else{
                    $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                    $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                    $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                    $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                }
            }
            for (i = 0; i < 3; i++)
            {
                if (marketbook.Runners[j].ExchangePrices.AvailableToLay.length > i && marketbook.Runners[j].ExchangePrices.AvailableToLay.length > 0)
                {

                    $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price);
                    $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','lay','" + marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size+"','"+ i +"','0')");
                    $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size);
                    $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','lay','" + marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size+"','"+ i +"','0')");
                }
                else{
                    $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                    $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                    $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                    $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                }
            }
            $("#marketbook"+marketbookID+" #lblrunnerlastprice"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].LastPriceTraded);
            $("#marketbook"+marketbookID+" #runnernamediv"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnerfavorite");
            if(marketbook.Runners[j].StatusStr=="WINNER"){

                $("#marketbook"+marketbookID+" #runnernamediv"+marketbook.Runners[j].SelectionId.toString()).addClass("runnerwinner");
                $("#marketbook"+marketbookID+" #lblSelectionName"+marketbook.Runners[j].SelectionId.toString()).attr('style', 'color: white !important');
                $("#marketbook"+marketbookID+" #lbljockey"+marketbook.Runners[j].SelectionId.toString()).attr('style', 'color: white !important');
                
                $("#lblfavoritename"+marketbookID).text($("#marketbook"+marketbookID+" #lblSelectionName"+marketbook.FavoriteID).text().toString().trim());
            }
            else{
                if (marketbook.MarketStatusstr != "Closed"){
                    $("#lblfavoritename"+marketbookID).text($("#marketbook"+marketbookID+" #lblSelectionName"+marketbook.FavoriteID).text().toString().trim());
                }
            }

            if(marketbook.FavoriteID.toString()==marketbook.Runners[j].SelectionId.toString() && marketbook.Runners[j].StatusStr!="WINNER")
            {
                $("#marketbook"+marketbookID+" #runnernamediv"+marketbook.Runners[j].SelectionId.toString()).addClass("runnerfavorite");

            }
            if(parseInt(marketbook.Runners[j].ProfitandLoss)>=0){
                $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossgreen");
                $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossred");
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersaveragegreen");
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersaveragered");
            
            }
            else{
                $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossred");
                $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossgreen");
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersaveragered");
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersaveragegreen");
            }
            if(parseInt(marketbook.Runners[j].Loss)>=0){
                $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossgreen");
                $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossred");
            }
            else{
                $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossred");
                $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossgreen");
            }
            if(marketbook.Runners[j].Average==null){
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).text("");
            }
            else{
                $("#marketbook"+marketbookID+" #lblaverage"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].Average);
            }
            $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ProfitandLoss);
            $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].Loss);


        }
        if (marketbook.MarketStatusstr == "In Play")
        {
          
            $(".backgroundimageforSuspended").removeClass("backgroundsuspended");
            $(".backgroundimageforSuspended").removeClass("backgroundclosed");
            $(".backgroundimageforSuspended").css({"display": "none"});

        }
        else
        {
            if (marketbook.MarketStatusstr == "Suspended")
            {  $('#myModalBetslipmultiple').modal('hide');
                $('#myModalBetslip').modal('hide');
                //$(".backgroundimageforSuspended").addClass("backgroundsuspended");
                //if($("#marketbook"+marketbookID+ " .tobeplacedcount").height()==null){
                //    $(".backgroundimageforSuspended").css({"margin-top":"47px"});
                //}
                //else{
                //    $(".backgroundimageforSuspended").css({"margin-top":"47px"});
                //}
                ////  $(".backgroundimageforSuspended label").text("Suspended");
                //$(".backgroundimageforSuspended").removeClass("backgroundclosed");

              
                //$(".backgroundimageforSuspended").css({"display": "block"});
            }
            else
            { if (marketbook.MarketStatusstr == "Active")
            {
               
                $(".backgroundimageforSuspended").removeClass("backgroundsuspended");
                $(".backgroundimageforSuspended").removeClass("backgroundclosed");
                $(".backgroundimageforSuspended").css({"display": "none"});

            }
            else{
                $('#myModalBetslipmultiple').modal('hide');
                $('#myModalBetslip').modal('hide');
                //$(".backgroundimageforSuspended").removeClass("backgroundsuspended");
                //if($("#marketbook"+marketbookID+" .tobeplacedcount").height()==null){
                //    $(".backgroundimageforSuspended").css({"margin-top":"47px"});
                //}
                //else{
                //    $(".backgroundimageforSuspended").css({"margin-top":"47px"});
                //}
                //$(".backgroundimageforSuspended").addClass("backgroundclosed");
                //// $(".backgroundimageforSuspended label").text("Closed");
              
                //$(".backgroundimageforSuspended").css({"display": "block"});
            }


            }
        }
        $("#marketbook"+marketbookID+" #lblSelectionName"+marketbook.FavoriteID).text().toString().trim();
        $("#lblfavoritename"+marketbookID).text($("#marketbook"+marketbookID+" #lblSelectionName"+marketbook.FavoriteID).text().toString().trim());

        $("#lblfavoritebackprice"+marketbookID).text(marketbook.FavoriteBack=="0"?"":marketbook.FavoriteBack);
        $("#lblfavoritebackprice"+marketbookID).attr("onclick","showbetslipmultiple('"+marketbook.FavoriteID +"','back','" + marketbook.FavoriteBack + 1 + "','4000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.FavoriteBackSize+"','0')");
        $("#lblfavoritelayprice"+marketbookID).text(marketbook.FavoriteLay=="0"?"":marketbook.FavoriteLay);
        $("#lblfavoritelayprice"+marketbookID).attr("onclick","showbetslipmultiple('"+marketbook.FavoriteID +"','lay','" + marketbook.FavoriteLay + 1 + "','4000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.FavoriteLaySize+"','0')");
        $("#lblfavoritebacksize"+marketbookID).text(marketbook.FavoriteBackSize=="0"?"":marketbook.FavoriteBackSize);
        $("#lblfavoritebacksize"+marketbookID).attr("onclick","showbetslipmultiple('"+marketbook.FavoriteID +"','back','" + marketbook.FavoriteBack + 1 + "','4000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.FavoriteBackSize+"','0')");
        $("#lblfavoritelaysize"+marketbookID).text(marketbook.FavoriteLaySize=="0"?"":marketbook.FavoriteLaySize);
        $("#lblfavoritelaysize"+marketbookID).attr("onclick","showbetslipmultiple('"+marketbook.FavoriteID +"','lay','" + marketbook.FavoriteLay + 1 + "','4000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.FavoriteLaySize+"','0')");

       
    }
    function AssignDatatoMarketBookFancy(marketbooks){

        var marketbook1= JSON.parse(marketbooks);


        var itemfound=0;

        for(k=0;k<=marketbook1.length-1;k++){
            var marketbook=marketbook1[k];
            var marketbookID=marketbook.MarketId.toString().replace(".","");
            for(j=0;j<=marketbook.Runners.length-1;j++){
              
				if($("#marketbook"+marketbookID).length==0){
				debugger;
				GetActiveMarketFancy();
				return;
				}

                $("#marketbookstatus"+marketbookID).val(marketbook.MarketStatusstr);
                $("#marketbookTotalMatched"+marketbookID).val(marketbook.TotalMatched.toString());
                try{
                    if((marketbook.Runners[j].ExchangePrices.AvailableToBack[0].Price > 0 || marketbook.Runners[j].ExchangePrices.AvailableToLay[0].Price > 0) && marketbook.MarketStatusstr=="In Play"){
                        $("#marketbook"+marketbookID).show();
                        itemfound=1;

                        for (i = 2; i >= 0; i--)
                        {
                            if (marketbook.Runners[j].ExchangePrices.AvailableToBack.length - 1 >= i && marketbook.Runners[j].ExchangePrices.AvailableToBack.length > 0)
                            {
                                if($("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text()!=marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price){
                                    $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).addClass("highlighted").delay(100).queue(function () {
                                        $(this).removeClass("highlighted").dequeue();
                                    });;
                                }


                                $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price );
                                $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','back','" + marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size+"','"+ i +"','0')");
                                if($("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text()!=marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size){
                                    $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).addClass("highlighted").delay(100).queue(function () {
                                        $(this).removeClass("highlighted").dequeue();
                                    });;
                                }
                                $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size);
                                $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','back','" + marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToBack[i].Size+"','"+ i +"','0')");
                            }
                            else{
                                $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                                $("#marketbook"+marketbookID+" #lblbackprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                                $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                                $("#marketbook"+marketbookID+" #lblbacksize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                            }
                        }
                        for (i = 0; i < 3; i++)
                        {
                            if (marketbook.Runners[j].ExchangePrices.AvailableToLay.length > i && marketbook.Runners[j].ExchangePrices.AvailableToLay.length > 0)
                            {
                                if($("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text()!=marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price){
                                    $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).addClass("highlighted").delay(100).queue(function () {
                                        $(this).removeClass("highlighted").dequeue();
                                    });;
                                }
                                $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price);
                                $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','lay','" + marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size+"','"+ i +"','0')");
                                if($("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text()!=marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size){
                                    $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).addClass("highlighted").delay(100).queue(function () {
                                        $(this).removeClass("highlighted").dequeue();
                                    });;
                                }
                                $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size=="0"?"":marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size);
                                $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","showbetslip('"+marketbook.Runners[j].SelectionId.toString() +"','lay','" + marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Price + "','2000','0','"+marketbook.MarketId+"','"+marketbook.MarketBookName+"','"+marketbook.Runners[j].ExchangePrices.AvailableToLay[i].Size+"','"+ i +"','0')");
                            }
                            else{
                                $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                                $("#marketbook"+marketbookID+" #lbllayprice"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                                $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).text("");
                                $("#marketbook"+marketbookID+" #lbllaysize"+i.toString()+ marketbook.Runners[j].SelectionId.toString()).attr("onclick","");
                            }
                        }
                        $("#marketbook"+marketbookID+" #lblrunnerlastprice"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].LastPriceTraded);
                        $("#marketbook"+marketbookID+" #runnernamediv"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnerfavorite");

                        if(parseInt(marketbook.Runners[j].ProfitandLoss)>=0){
                            $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossgreen");
                            $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossred");
                        }
                        else{
                            $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossred");
                            $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossgreen");
                        }
                        if(parseInt(marketbook.Runners[j].Loss)>=0){
                            $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossgreen");
                            $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossred");
                        }
                        else{
                            $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).addClass("runnersprofitlossred");
                            $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).removeClass("runnersprofitlossgreen");
                        }
                        $("#marketbook"+marketbookID+" #lblprofitandloss"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].ProfitandLoss);
                        $("#marketbook"+marketbookID+" #lblloss"+marketbook.Runners[j].SelectionId.toString()).text(marketbook.Runners[j].Loss);

                    }

                    else{
                        $("#marketbook"+marketbookID).hide();
                    }
                }
                catch(err){
                    $("#marketbook"+marketbookID).hide();
                }
            }
        }
        if(itemfound==1){
            $(".fancybackandlaydiv").show();
           
           
        }
        else{
            $(".fancybackandlaydiv").hide();
        }
        if( $("#marketbookdataforshow").css("display")=="block"){
            $("#fancymarketbook").show();
        }
        else{
            $("#fancymarketbook").hide();
        }

    }
    function round(value, decimals) {
        return Number(Math.round(value+'e'+decimals)+'e-'+decimals);
    }
    function GetAmountformultiplebetbySelectionID(selectionID){

        if($("#betsliptype").val() == 'back'){
            var odd = $("#betslipbackmultiple").text();
            var amount = $("#betslipamountmultiple").val();
            var totamount=(parseFloat(odd) * parseFloat(amount)).toFixed("2");
            var currentoddbyselectionID=$("#lblbackprice0"+selectionID).text().toString().trim();
            var amountforcurrentodd=((100/parseFloat(currentoddbyselectionID)) * totamount)/100;

        }

    }

    function GenerateHTMLForMultipleRunners(){

        var marketbookdID= $("#lastloadedmarket").val().toString().replace(".","");
        var selectedrunners= $("#selectedrunners"+marketbookdID).val();

        if (selectedrunners !=""){
            selectedrunners = JSON.parse(selectedrunners);

            var htmlstr="";
            for(i=0;i<=selectedrunners.length-1;i++){


                htmlstr+='<div class="col-md-12 no-padding betslipselections">';
                htmlstr+='<div class="col-md-6 no-padding betslipselectionname">';
                htmlstr+='<label id="lblbetsliprunnername' + selectedrunners[i] + '">'+$("#lblSelectionName"+selectedrunners[i]).text() + '</label>';

                htmlstr+='</div>';
                htmlstr+='<div class="col-md-3 no-padding betslipodd">';
                htmlstr+='<label id="lblbetslipbackodd' + selectedrunners[i] + '">'+ $("#marketbook"+marketbookdID+" #lblbackprice0"+selectedrunners[i]).text().toString().trim()+'</label>';
                htmlstr+='</div>';
                htmlstr+='<div class="col-md-3 no-padding betslipodd">';
                htmlstr+='<label id="lblbetsliplayodd' + selectedrunners[i] + '">'+ $("#marketbook"+marketbookdID+" #lbllayprice0"+selectedrunners[i]).text().toString().trim()+'</label>';
                htmlstr+='</div>';
                htmlstr+='</div>';
            }
            $("#betslipmultiplerunners").html(htmlstr);
        }
    }
    function SetSelectedRunners(){

        var marketbookdID= $("#lastloadedmarket").val().toString().replace(".","");
        var selectedrunners= $("#selectedrunners"+marketbookdID).val();
        var selectedClothnumbers=$("#selectedrunnersclothnumber"+marketbookdID).val();
        if (selectedrunners !="" && selectedrunners != undefined){

            selectedrunners = JSON.parse(selectedrunners);
            selectedClothnumbers = JSON.parse(selectedClothnumbers);
            GenerateHTMLForMultipleRunners();
            var bettype="back";
            var lastoddback=$("#marketbook"+marketbookdID+" #lblbackprice0"+selectedrunners[0]).text().toString().trim();
            $("#lblbetslipbackodd"+selectedrunners[0]).text(lastoddback);
            lastoddback=parseFloat(lastoddback)-1;
            var lastoddlay=$("#marketbook"+marketbookdID+" #lbllayprice0"+selectedrunners[0]).text().toString().trim();
            $("#lblbetsliplayodd"+selectedrunners[0]).text(lastoddlay);
            lastoddlay=parseFloat(lastoddlay)-1;
            var selectionname="";

            if(selectedClothnumbers[0] ==""){

                var selectionnameactual=$("#marketbook"+marketbookdID+" #lblSelectionName"+selectedrunners[0]).text().toString().trim().split(".");
                selectionname=selectionnameactual[0];

            }
            else{
                selectionname=selectedClothnumbers[0];
            }


            if(lastoddback < 0){
                lastoddback=0;
            }
            if (lastoddlay < 0){
                lastoddlay=0;
            }

            for(i=0; i <= selectedrunners.length-1; i++) {
                $("#chkselection"+selectedrunners[i]).prop("checked",true);

                if ( i+1 < selectedrunners.length){

                    var currentrunneroddback=$("#marketbook"+marketbookdID+" #lblbackprice0"+selectedrunners[i+1]).text().toString().trim();
                    $("#lblbetslipbackodd"+selectedrunners[i+1]).text(currentrunneroddback);
                    currentrunneroddback=parseFloat(currentrunneroddback)-1;

                    var currentrunneroddlay=$("#marketbook"+marketbookdID+" #lbllayprice0"+selectedrunners[i+1]).text().toString().trim();
                    $("#lblbetsliplayodd"+selectedrunners[i+1]).text(currentrunneroddlay);
                    currentrunneroddlay=parseFloat(currentrunneroddlay)-1;
                    var equation1back=(parseFloat(lastoddback)+currentrunneroddback)+2;
                    var equation2back=(parseFloat(lastoddback)*currentrunneroddback)-1;

                    lastoddback=round(equation2back/equation1back,2).toFixed(2);
                    if (lastoddback=="NaN" || lastoddback <= 0){
                        lastoddback="0.00";
                    }
                    var equation2lay=(parseFloat(lastoddlay)* currentrunneroddlay)-1;
                    var equation1lay=(parseFloat(lastoddlay)+ currentrunneroddlay)+2;
                    lastoddlay=round(equation2lay/equation1lay,2).toFixed(2);
                    if (lastoddlay=="NaN" || lastoddlay <= 0){
                        lastoddlay="0.00";
                    }

                    if(selectedClothnumbers[i+1] ==""){
                        var selectionnameactual=$("#marketbook"+marketbookdID+" #lblSelectionName"+selectedrunners[i+1]).text().toString().trim().split(".");
                        selectionname=selectionname+"+"+selectionnameactual[0];

                    }
                    else{
                        selectionname=selectionname+"+"+ selectedClothnumbers[i+1];
                    }

                    var marketbookdID= $("#lastloadedmarket").val().toString().replace(".","");
                    $("#lblfavoritename"+marketbookdID).text(selectionname);
					  $("#lblfavoritename"+marketbookdID).css({"text-align":"center"});
                    $("#lblfavoritebackprice"+marketbookdID).text(lastoddback);
                    $("#betslipbackmultiple").text(lastoddback);
                    $("#betsliplaymultiple").text(lastoddlay);
                    calculateamountsmultiple();
                    $("#lblfavoritelayprice"+marketbookdID).text(lastoddlay);
                    $("#lblfavoritebacksize"+marketbookdID).text($("#marketbook"+marketbookdID+" #lblbacksize0"+selectedrunners[i+1]).text().toString().trim());
                    $("#lblfavoritelaysize"+marketbookdID).text($("#marketbook"+marketbookdID+" #lbllaysize0"+selectedrunners[i+1]).text().toString().trim());

                }
            }
			
        }
 else{
            $("#lblfavoritename"+marketbookdID).css({"text-align":"center"});
    }

    }
	 function AddRunnersforaveragecal(id){
        var marketbbokname=$("#marketbookname"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var marketbookdID= $("#lastloadedmarket").val().toString().replace(".","");
        var mainsportcat=$("#marketbookCategory"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var chkid=$("#marketbook"+marketbookdID +" #chkselectionforaverage"+id).prop("checked");

        var selectedrunners= $("#selectedrunnersforavg"+marketbookdID).val();
        debugger;
        if (chkid==true){

            if (selectedrunners==""){
                var runnersarr=[];
                runnersarr.push(id);
                $("#selectedrunnersforavg"+marketbookdID).val(JSON.stringify(runnersarr));

            }
            else{
                selectedrunners = JSON.parse(selectedrunners);
                selectedrunners.push(id);

                $("#selectedrunnersforavg"+marketbookdID).val(JSON.stringify(selectedrunners));

            }


        }
        else{

            if (selectedrunners !=""){
                selectedrunners = JSON.parse(selectedrunners);

            }
            for(var i = selectedrunners.length; i--;) {
                if(selectedrunners[i] === id) {
                    selectedrunners.splice(i, 1);

                    break;
                }
            }
            if (selectedrunners.length > 0){

                $("#selectedrunnersforavg"+marketbookdID).val(JSON.stringify(selectedrunners));

            }
            else{
                $("#selectedrunnersforavg"+marketbookdID).val("");

            }

        }


	 }
	 function AddRunnersforaveragecalTWT(id){
	     var marketbbokname=$("#marketbookname"+$("#lastloadedmarketTWT").val().toString().replace(".","")).val();
	     var marketbookdID= $("#lastloadedmarketTWT").val().toString().replace(".","");
	     var mainsportcat=$("#marketbookCategory"+$("#lastloadedmarketTWT").val().toString().replace(".","")).val();
	     var chkid=$("#marketbook"+marketbookdID +" #chkselectionforaverage"+id).prop("checked");

	     var selectedrunners= $("#selectedrunnersforavg"+marketbookdID).val();
	     debugger;
	     if (chkid==true){

	         if (selectedrunners==""){
	             var runnersarr=[];
	             runnersarr.push(id);
	             $("#selectedrunnersforavg"+marketbookdID).val(JSON.stringify(runnersarr));

	         }
	         else{
	             selectedrunners = JSON.parse(selectedrunners);
	             selectedrunners.push(id);

	             $("#selectedrunnersforavg"+marketbookdID).val(JSON.stringify(selectedrunners));

	         }


	     }
	     else{

	         if (selectedrunners !=""){
	             selectedrunners = JSON.parse(selectedrunners);

	         }
	         for(var i = selectedrunners.length; i--;) {
	             if(selectedrunners[i] === id) {
	                 selectedrunners.splice(i, 1);

	                 break;
	             }
	         }
	         if (selectedrunners.length > 0){

	             $("#selectedrunnersforavg"+marketbookdID).val(JSON.stringify(selectedrunners));

	         }
	         else{
	             $("#selectedrunnersforavg"+marketbookdID).val("");

	         }

	     }


	 }
    function AddRunnersformultiplebets(id){
        var marketbbokname=$("#marketbookname"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var marketbookdID= $("#lastloadedmarket").val().toString().replace(".","");
        var mainsportcat=$("#marketbookCategory"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        if (marketbbokname.indexOf("To Be Placed")>=0 || mainsportcat.indexOf("Racing")< 0){
            $("#marketbook"+marketbookdID +" #chkselection"+id).prop("checked",false);
            // $("#marketbook"+marketbookdID +" #clothnumstalldrawimg"+id).css({"background-color":"white"});
            return;
        }

        var marketstatus=  $("#marketbookstatus"+marketbookdID).text();
        if (marketstatus=="Market Suspended" || marketstatus=="Market Closed"){
            $("#marketbook"+marketbookdID +" #chkselection"+id).prop("checked",false);
            //  $("#marketbook"+marketbookdID +" #clothnumstalldrawimg"+id).css({"background-color":"white"});
            return;
        }
        var chkid=$("#marketbook"+marketbookdID +" #chkselection"+id).prop("checked");

        var selectedrunners= $("#selectedrunners"+marketbookdID).val();
        var selectedClothnumbers=$("#selectedrunnersclothnumber"+marketbookdID).val();

        if (chkid==true){
            $("#marketbook"+marketbookdID+ " #selection"+id).addClass("runnerselectedhorse");
            if (selectedrunners==""){
                var runnersarr=[];
                runnersarr.push(id);
                var runnerclothes=[];
                $("#lblSelectionClothnumber"+id).text();
                runnerclothes.push($("#lblSelectionClothnumber"+id).text());
                $("#selectedrunners"+marketbookdID).val(JSON.stringify(runnersarr));
                $("#selectedrunnersclothnumber"+marketbookdID).val(JSON.stringify(runnerclothes));
            }
            else{
                selectedrunners = JSON.parse(selectedrunners);
                selectedrunners.push(id);
                selectedClothnumbers = JSON.parse(selectedClothnumbers);
                selectedClothnumbers.push($("#lblSelectionClothnumber"+id).text());
                $("#selectedrunners"+marketbookdID).val(JSON.stringify(selectedrunners));
                $("#selectedrunnersclothnumber"+marketbookdID).val(JSON.stringify(selectedClothnumbers));
            }


        }
        else{
            $("#marketbook"+marketbookdID+ " #selection"+id).removeClass("runnerselectedhorse");
            if (selectedrunners !=""){
                selectedrunners = JSON.parse(selectedrunners);
                selectedClothnumbers = JSON.parse(selectedClothnumbers);
            }
            for(var i = selectedrunners.length; i--;) {
                if(selectedrunners[i] === id) {
                    selectedrunners.splice(i, 1);
                    selectedClothnumbers.splice(i,1);
                    break;
                }
            }
            if (selectedrunners.length > 0){

                $("#selectedrunners"+marketbookdID).val(JSON.stringify(selectedrunners));
                $("#selectedrunnersclothnumber"+marketbookdID).val(JSON.stringify(selectedClothnumbers));
            }
            else{
                $("#selectedrunners"+marketbookdID).val("");
                $("#selectedrunnersclothnumber"+marketbookdID).val("");
            }

        }

        // $("#selectedrunnersformultiplebets")
    }
    function LoadMarketTypeandUserBetsAgent() {
        $("#lastsavedhtml").val($("div[data-marketid='" + $("#lastloadedmarket").val() + "']").html());
        $.when($.ajax({
            url: '/Market/LoadActiveMarket/',

            type: 'GET',
            async:true,
            data: { 'ID':  $("#lastloadedmarket").val() },
        }), $.ajax({
            url: '/UserBet/UserBets',
            type: 'GET',
            async: true,

        })).then(function (res1, res2) {

            $("div[data-marketid='" + $("#lastloadedmarket").val() + "']").html(res1[0]);

            if ($("#lastsavedhtml").val().trim() == "") {
                $("#lastsavedhtml").val($("div[data-marketid='" + $("#lastloadedmarket").val() + "']").html());
            }
            comparemarketbook();


            $("#userbets").html(res2[0]);
            LoadMarketTypeandUserBetsAgent();
        });
    }
    var isfirstclick=true;
    function triggerchangemethod(id,marketbookid){


        var check=  $("#marketbook"+marketbookid +" #chkselection"+id).prop("checked");
        if(check==true){
            $("#marketbook"+marketbookid +" #chkselection"+id).prop("checked",false);
            // $("#marketbook"+marketbookid +" #clothnumstalldrawimg"+id).css({"background-color":"white"});

        }
        else{
            $("#marketbook"+marketbookid +" #chkselection"+id).prop("checked",true    );
            //  $("#marketbook"+marketbookid +" #clothnumstalldrawimg"+id).css({"background-color":"white"});
        }
        AddRunnersformultiplebets(id);

    }
    var isInserting = false;
    $(document).ready(function () {

        $("#cdialog").dialog({
            modal: true,
            bgiframe: true,
            width: $(window).width()-25,
            height: 150,
            autoOpen: false
        });



        $("#maineventtypediv").insertAfter(".mainheaderdiv");
        //  $("#mainuserbetdiv").insertAfter("#maineventtypediv");
        LoadUserBets();
        @*if(@LoggedinUserDetail.GetUserTypeID()==3){

        }*@
        // StartUserbetsLoadingAgent();
        //
        //  StartUserbetsLoading();
        SetFirstItemActive("");
        // LoadMarketType("");
        if(fromclicklocation=="footer"){
            {
                $(".maincategory-sports").show();
                $(".usernameandliablity").hide();
                $("#partialviews").hide();

            }

        }
        
        togglemainsportsmenu(2,"footer");
        //   StartMarketLoading();

        //LoadMarketTypeandUserBets();
        function LoadMarketTypeandUserBets() {
            $.when($.ajax({
                url: '/Market/MarketBook/',

                type: 'GET',

                data: { 'ID': "" },
            }), $.ajax({
                url: '/Market/UserBets',
                type: 'GET',
                async: true,

            })).then(function (res1, res2) {

                $("#marketbook").html(res1[0]);

                if ($("#lastsavedhtml").val().trim() == "") {
                    $("#lastsavedhtml").val($("#marketbook").html());
                }
                comparemarketbook();
                SetFirstItemActive($("#lastloadedmarket").val());
                $("#userbets").html(res2[0]);
                LoadMarketTypeandUserBets();
            });
        }

        function StartUserbetsLoading() {
            if (@LoggedinUserDetail.GetUserTypeID()==3){
                setInterval(function () {

                    var totcount = $(".unmatched-bets .bets-items").length;
                    if (totcount > 0) {
                        LoadUserBets();
                    }

                }, 1000);
            }

        }
        function StartUserbetsLoadingAgent() {
            if (@LoggedinUserDetail.GetUserTypeID()!=3){
                setInterval(function () {
                    LoadUserBetsforAgent();

                }, 1000)
            }

        }
        function StartMarketLoading() {
            setInterval(function () {



            }, 0);
        }

        $(".amountbutton input[type='button']").click(function () {
            //var betlowerlimit=setBetslipamountlowerlimit();
            //if(betlowerlimit ==$("#betslipamount").val()){
            //    $("#betslipamount").val('0');
            //}
            if(isInserting==true){
                return;
            }
            if(isfirstclick==true){
                $("#betslipamount").val('0');
            }
            if ($(this).val().indexOf('+') >= 0) {
                var newamount = parseFloat($("#betslipamount").val()) + parseFloat($(this).attr("data-value"));
                $("#betslipamount").val(newamount);
            }
            else {
                $("#betslipamount").val($(this).attr("data-value"));
            }
            isfirstclick=false;
            calculateamounts();

        });
        $(".amountbuttonmultiple input[type='button']").click(function () {
            if(isInserting==true){
                return;
            }
            if(isfirstclick==true){
                $("#betslipamountmultiple").val('0');
            }
            if ($(this).val().indexOf('+') >= 0) {
                var newamount = parseFloat($("#betslipamountmultiple").val()) + parseFloat($(this).attr("data-value"));
                $("#betslipamountmultiple").val(newamount);
            }
            else {
                $("#betslipamountmultiple").val($(this).attr("data-value"));
            }
            isfirstclick=false;
            calculateamountsmultiple();

        });
        $("#btnBetslipClose").click(function () {
            isfirstclick=true;
        });
        $("#betslipback").click(function () {
            if(isInserting==true){
                return;
            }
            if ($("#betsliptype").val() == 'back') {
                var value = $("#betslipback").text().trim();
                $("#betslipodd").val(value);
                calculateamounts();
            }

        });
        $("#betsliplay").click(function () {
            if(isInserting==true){
                return;
            }
            if ($("#betsliptype").val() == 'lay') {
                var value = $("#betsliplay").text().trim();
                $("#betslipodd").val(value);
                calculateamounts();
            }
        });


        $("#btnBetslipsubmit").click(function () {
                    debugger;
            $("#btnBetslipsubmit").prop('disabled', true);
            $("#btnBetslipReset").prop('disabled', true);
           
            var betamounttobeplaced=parseFloat($("#betslipamount").val().trim());
            var lowerbetlimit= 2000;
            var betupperlimit=500000;

            var marketbookID=  $("#loadedmarketbook").val().toString().replace(".","");

            var categoryname=$("#marketbookCategory"+marketbookID).val();

            var marketbookname= $("#loadedmarketbookname").val();
            var marketbookrunners=$("#marketbookrunners"+marketbookID).val();
            debugger;
            if(marketbookrunners=="1"){
                lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitFancy();
                betupperlimit=@LoggedinUserDetail.GetBetUpperLimitFancy();
            }
            else{
                if (categoryname.indexOf("Horse Racing")>=0 && marketbookname.indexOf("To Be Placed")< 0){
                    lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimit();
                    betupperlimit=@LoggedinUserDetail.GetBetUpperLimit();
                }
                else{
                    if (categoryname.indexOf("Horse Racing")>=0 && marketbookname.indexOf("To Be Placed")>=0){
                        lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitHorsePlace();
                        betupperlimit=@LoggedinUserDetail.GetBetUpperLimitHorsePlace();
                    }
                    else{
                        if (categoryname.indexOf("Greyhound Racing")>=0 && marketbookname.indexOf("To Be Placed")>=0){
                            lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitGrayHoundPlace();
                            betupperlimit=@LoggedinUserDetail.GetBetUpperLimitGrayHoundPlace();
                        }
                        else{
                            if (categoryname.indexOf("Greyhound Racing")>=0 && marketbookname.indexOf("To Be Placed")< 0){
                                lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitGrayHoundWin();
                                betupperlimit=@LoggedinUserDetail.GetBetUpperLimitGrayHoundWin();
                            }
                            else{
                                if (marketbookname.indexOf("Completed Match")>=0){
                                    lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitCompletedMatch();
                                    betupperlimit=@LoggedinUserDetail.GetBetUpperLimitCompletedMatch();
                                }
                                else{
                                    if (marketbookname.indexOf("Innings Runs")>=0 ||marketbookname.indexOf("Inns Runs")>=0){
                                        lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitInningsRuns();
                                        betupperlimit=@LoggedinUserDetail.GetBetUpperLimitInningsRuns();
                                    }
                                    else{
                                        if(categoryname=="Tennis"){
                                            lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitMatchOddsTennis();
                                            betupperlimit=@LoggedinUserDetail.GetBetUpperLimitMatchOddsTennis();
                                        }
                                        else{
                                            if(categoryname=="Soccer"){
                                                lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitMatchOddsSoccer();
                                                betupperlimit=@LoggedinUserDetail.GetBetUpperLimitMatchOddsSoccer();
                                            }
                                            else{
                                                if (marketbookname.indexOf("Tied Match")>=0){
                                                    lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitTiedMatch();
                                                    betupperlimit=@LoggedinUserDetail.GetBetUpperLimitTiedMatch();
                                                }
                                                else{
                                                    if (marketbookname.indexOf("Winner")>=0 || marketbookname.indexOf("To Win the Toss")>=0){
                                                        lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitWinner();
                                                        betupperlimit=@LoggedinUserDetail.GetBetUpperLimitWinner();
                                                    }
                                                    else{
                                                        lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitMatchOdds();
                                                        betupperlimit=@LoggedinUserDetail.GetBetUpperLimitMatchOdds();
                                                    }
                                                }

                                            }
                                        }

                                    }
                                }
                            }
                        }
                    }
                }
            }








            var alreadypendingamount=0;
            $(".unmatched-bets .bets-items").each(function(){
                alreadypendingamount+=parseFloat($(this).attr("data-amount"));
            });
            if(alreadypendingamount >= betupperlimit){
                ShowErrorMsg("Already reached to limit. Please cancel any unmatch bet.");
                $("#btnBetslipsubmit").prop('disabled', false);
                $("#btnBetslipReset").prop('disabled', false);
                    HideLoader();
                return;
            }
            if (betamounttobeplaced < lowerbetlimit || betamounttobeplaced > betupperlimit ) {
                ShowErrorMsg("Amount should not be less than " + lowerbetlimit +" and greater than "+ betupperlimit +".");
                $("#btnBetslipsubmit").prop('disabled', false);
                $("#btnBetslipReset").prop('disabled', false);
                    HideLoader();
                return;
            }

            var selectionIDs1=[];
            selectionIDs1.push($("#openedbetslipid").val());
            var betamount=0;

            $.ajax({
                url: '/UserBet/CheckforPlaceBet',

                type: 'POST',
                async:false,
                data: { 'Amount': $("#betslipamountlabel").text().trim(), 'Odd': $("#betslipodd").val().trim().replace(".00",""), 'BetType': $("#betsliptype").val(), 'SelectionID': selectionIDs1,'marketbookID':$("#loadedmarketbook").val(),'MarketbookName':marketbookname ,'Runnerscount':marketbookrunners},

                complete: function () { },
                success: function (data) {

                    if (data == "True") {
                        isInserting = true;
                        // ShowLoader();
                        $(".loadingimg").show();
                        var categoryname=$("#marketbookCategory"+marketbookID).val();
                        var counter = 6;
                        ////
                        $.ajax({
                            url: '/DashBoard/GetBetPlaceInterval',

                            type: 'GET',
                            async:false,
                            data: { 'categoryname': categoryname, 'Marketbookname': marketbookname,'Runnerscount':marketbookrunners },

                            complete: function () { },
                            success: function (data) {

                                var timinginterval=data;
                                if (categoryname.indexOf("Racing")>=0){
                                    counter=2;
                                    // timinginterval=1000;
                                }
                                if (marketbookname.indexOf("Innings Runs")>=0 ||marketbookname.indexOf("Inns Runs")>=0){
                                    //  timinginterval=1600;
                                }
                                $("#lblCounter").html(counter);
                                var interval = setInterval(
                                function () {
                                    counter--;
                                    $("#lblCounter").html(counter);
                                    if (counter == 1) {
                                        $("#lblCounter").html('');
                                        $('#myModalBetslip').modal('hide');
                                        $(".loadingimg").hide();
                                        HideLoader();
                                        clearInterval(interval);
                                        if(@LoggedinUserDetail.CheckConditionsforPlaceBet()==0){
                                            insertbetslipSimple();
                                        }
                                        else{
                                            insertbetslip();
                                        }
                                        $('html,body').animate({scrollTop: $("#userbets").offset().top}, 800);
                                        //LoadUserBets();
                                        Loadliabalitiesbymarkets();
                                        parentID = 0;
                                        isInserting = false;
                                        $("#btnBetslipsubmit").prop('disabled', false);
                                        $("#btnBetslipReset").prop('disabled', false);

                                    }

                                }, timinginterval);
                            }
                        });
                        /////

                    }
                    else {
                        $("#btnBetslipsubmit").prop('disabled', false);
                        $("#btnBetslipReset").prop('disabled', false);
                        $(".loadingimg").hide();
                        HideLoader();
                        ShowErrorMsg(data);
                    }


                }
            });



        });

        $("#btnBetslipsubmitmultiple").click(function () {
           
            $(".loadingimg").show();
            $("#btnBetslipsubmitmultiple").prop('disabled', true);
            $("#btnBetslipResetmultiple").prop('disabled', true);
            setTimeout(function () {

            }, 100);
            var betamounttobeplaced=parseFloat($("#betslipamountmultiple").val().trim());
            var lowerbetlimit= 2000;
            var betupperlimit=500000;
            var categoryname=$("#marketbookCategory"+$("#lastloadedmarket").val().toString().replace(".","")).val();
            var marketbookname=$("#marketbookname"+$("#lastloadedmarket").val().toString().replace(".","")).val();
            if (categoryname.indexOf("Horse Racing")>=0 && marketbookname.indexOf("To Be Placed")<0){
                lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimit();
                betupperlimit=@LoggedinUserDetail.GetBetUpperLimit();
            }
            else{
                if (categoryname.indexOf("Horse Racing")>=0 && marketbookname.indexOf("To Be Placed")>=0){
                    lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitHorsePlace();
                    betupperlimit=@LoggedinUserDetail.GetBetUpperLimitHorsePlace();
                }
                else{
                    if (categoryname.indexOf("Greyhound Racing")>=0 && marketbookname.indexOf("To Be Placed")>=0){
                        lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitGrayHoundPlace();
                        betupperlimit=@LoggedinUserDetail.GetBetUpperLimitGrayHoundPlace();
                    }
                    else{
                        if (categoryname.indexOf("Greyhound Racing")>=0 && marketbookname.indexOf("To Be Placed")< 0){
                            lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitGrayHoundWin();
                            betupperlimit=@LoggedinUserDetail.GetBetUpperLimitGrayHoundWin();
                        }
                        else{
                            if (marketbookname.indexOf("Completed Match")>=0){
                                lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitCompletedMatch();
                                betupperlimit=@LoggedinUserDetail.GetBetUpperLimitCompletedMatch();
                            }
                            else{
                                if (marketbookname.indexOf("Innings Runs")>=0 ||marketbookname.indexOf("Inns Runs")>=0){
                                    lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitInningsRuns();
                                    betupperlimit=@LoggedinUserDetail.GetBetUpperLimitInningsRuns();
                                }
                                else{
                                    if(categoryname=="Tennis"){
                                        lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitMatchOddsTennis();
                                        betupperlimit=@LoggedinUserDetail.GetBetUpperLimitMatchOddsTennis();
                                    }
                                    else{
                                        if(categoryname=="Soccer"){
                                            lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitMatchOddsSoccer();
                                            betupperlimit=@LoggedinUserDetail.GetBetUpperLimitMatchOddsSoccer();
                                        }
                                        else{
                                            if (marketbookname.indexOf("Tied Match")>=0){
                                                lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitTiedMatch();
                                                betupperlimit=@LoggedinUserDetail.GetBetUpperLimitTiedMatch();
                                            }
                                            else{
                                                if (marketbookname.indexOf("Winner")>=0){
                                                    lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitWinner();
                                                    betupperlimit=@LoggedinUserDetail.GetBetUpperLimitWinner();
                                                }
                                                else{
                                                    lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitMatchOdds();
                                                    betupperlimit=@LoggedinUserDetail.GetBetUpperLimitMatchOdds();
                                                }
                                            }

                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }

            lowerbetlimit=lowerbetlimit * 2;
            betupperlimit=betupperlimit * 2;
            var alreadypendingamount=0;
            $(".unmatched-bets .bets-items").each(function(){
                alreadypendingamount+=parseFloat($(this).attr("data-amount"));
            });
            if(alreadypendingamount >= betupperlimit){
                ShowErrorMsg("Already reached to limit. Please cancel any unmatch bet.");
                $("#btnBetslipsubmit").prop('disabled', false);
                $("#btnBetslipReset").prop('disabled', false);
                $(".loadingimg").hide();
                    HideLoader();
                return;
            }

            if (betamounttobeplaced < lowerbetlimit || betamounttobeplaced > betupperlimit ) {
                ShowErrorMsg("Amount should not be less than " + lowerbetlimit +" and greater than "+ betupperlimit +".");
                $("#btnBetslipsubmitmultiple").prop('disabled', false);
                $("#btnBetslipResetmultiple").prop('disabled', false);
                $(".loadingimg").hide();
                HideLoader();
                return;
            }

            //if ($("#betslipamountmultiple").val().trim() < 4000) {
            //    ShowErrorMsg("Amount should not be less than 4000.");
            //    $("#btnBetslipsubmitmultiple").prop('disabled', false);
            //    $("#btnBetslipResetmultiple").prop('disabled', false);
            //    return;
            //}

            var selectionIDs2=[];
            var marketbookdID= $("#lastloadedmarket").val().toString().replace(".","");
            var selectedrunners= $("#selectedrunners"+marketbookdID).val();

            if (selectedrunners !=""){
                selectedrunners = JSON.parse(selectedrunners);

                for(i=0;i<=selectedrunners.length-1;i++){
                    selectionIDs2.push(selectedrunners[i]);
                }
            }
            var marketbookrunners=$("#marketbookrunners"+marketbookdID).val();
            $.ajax({
                url: '/UserBet/CheckforPlaceBet',

                type: 'POST',
                async:false,
                data: { 'Amount': $("#betslipamountlabelmultiple").text().trim(), 'Odd':"0", 'BetType': $("#betsliptype").val(), 'SelectionID': selectionIDs2,'marketbookID':$("#lastloadedmarket").val(),'Runnerscount':marketbookrunners },

                complete: function () { },
                success: function (data) {

                    if (data == "True") {
                        isInserting = true;
                        // ShowLoader();
                        $('#myModalBetslipmultiple').modal('hide');




                        $("#btnBetslipsubmitmultiple").prop('disabled', false);
                        $("#btnBetslipResetmultiple").prop('disabled', false);
                        for(i=0;i<=selectedrunners.length-1;i++){

                            if($("#betsliptype").val() == 'back'){

                                var odd =parseFloat( $("#betslipbackmultiple").text());
                                var amount =parseFloat( $("#betslipamountmultiple").val());
                                var totamount=parseFloat(odd * amount);
                                totamount   =totamount+amount;
                                var currentoddbyselectionID=$("#marketbook"+marketbookdID+" #lblbackprice0"+selectedrunners[i]).text().toString().trim();
                                var amountforcurrentodd=100/parseFloat(currentoddbyselectionID);
                                amountforcurrentodd=amountforcurrentodd* totamount;
                                amountforcurrentodd=amountforcurrentodd/100;

                                $("#loadedbetlocation").val("");
                                $("#clickedodd").val("");
                                $("#clickedbetsize").val("");
                                $("#clickedID").val(0);
                                $("#betslipback").text($("#marketbook"+marketbookdID+" #lblbackprice0"+selectedrunners[i]).text().toString().trim())
                                $("#betslipsize").text($("#marketbook"+marketbookdID+" #lblbacksize0"+selectedrunners[i]).text().toString().trim())
                                $("#openedbetslipid").val(selectedrunners[i]);
                                var clothnumber=$("#lblSelectionClothnumber"+selectedrunners[i]).text().toString().trim();;
                                var selectionname=$("#lblSelectionName"+selectedrunners[i]).text().toString().trim();
                                if(clothnumber!=""){
                                    selectionname=clothnumber+"."+selectionname;
                                }


                                $("#betslipselection").html(selectionname);
                                $("#betslipamount").val(parseInt(amountforcurrentodd));
                                $("#betslipodd").val(currentoddbyselectionID);
                                parentID = 0;
                                insertbetslip();
                            }
                            else{
                                var odd = parseFloat($("#betsliplaymultiple").text());
                                var amount =parseFloat( $("#betslipamountmultiple").val());
                                var totamount=parseFloat(odd * amount);
                                totamount   =totamount+amount;
                                var currentoddbyselectionID=$("#marketbook"+marketbookdID+" #lbllayprice0"+selectedrunners[i]).text().toString().trim();
                                var amountforcurrentodd=100/parseFloat(currentoddbyselectionID);
                                amountforcurrentodd=amountforcurrentodd* totamount;
                                amountforcurrentodd=amountforcurrentodd/100;
                                $("#loadedbetlocation").val("");
                                $("#clickedodd").val("");
                                $("#clickedbetsize").val("");
                                $("#clickedID").val(0);
                                $("#betsliplay").text($("#marketbook"+marketbookdID+" #lbllayprice0"+selectedrunners[i]).text().toString().trim())
                                $("#betslipsize").text($("#marketbook"+marketbookdID+" #lbllaysize0"+selectedrunners[i]).text().toString().trim())
                                $("#openedbetslipid").val(selectedrunners[i]);
                                var clothnumber=$("#lblSelectionClothnumber"+selectedrunners[i]).text().toString().trim();;
                                var selectionname=$("#lblSelectionName"+selectedrunners[i]).text().toString().trim();
                                if(clothnumber!=""){
                                    selectionname=clothnumber+"."+selectionname;
                                }


                                $("#betslipselection").html(selectionname);
                                $("#betslipamount").val(parseInt(amountforcurrentodd));
                                $("#betslipodd").val(currentoddbyselectionID);
                                parentID = 0;
                                insertbetslip();
                            }
                        }
                        $('html,body').animate({scrollTop: $("#userbets").offset().top}, 800);

                        isInserting= false;
                        $(".loadingimg").hide();
                        Loadliabalitiesbymarkets();
                        HideLoader();



                    }
                    else {
                        $("#btnBetslipsubmitmultiple").prop('disabled', false);
                        $("#btnBetslipResetmultiple").prop('disabled', false);
                        $(".loadingimg").hide();
                        HideLoader();
                        ShowErrorMsg(data);
                    }


                }
            });



        });
    });
    function insertbetslipSimple(){
        var cuttinguserid=$("#allusersCuttingUsers"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        if(cuttinguserid==0){
            ShowErrorMsg("Please Select User");
            return;
        }
        $("#btnAdminBet").prop('disabled', true);

        var marketbookID=$("#lastloadedmarket").val().toString().replace(".","");
        var selectionID =$("#ddlRunnersBetAdmin"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var selectionname=$("#lblSelectionName"+selectionID).text();
        var marketbookname=$("#marketbookname"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var bettype=$("#ddladminbettype"+$("#lastloadedmarket").val().toString().replace(".","")+" option:selected").val();
        var userodd=$("#txtAdminOdd"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var amount=$("#txtAdminAmount"+$("#lastloadedmarket").val().toString().replace(".","")).val();

        dataurl = '/UserBet/InsertUserBetAdmin';

        $.ajax({
            url: dataurl,

            type: 'POST',
            async: false,
            data: { 'SelectionID': selectionID, 'selecitonname': selectionname, 'userOdd': userodd, 'amount': amount, 'bettype': bettype, 'liveodd': userodd, 'ismatched': true, 'status': 'In-Complete', 'marketbookid': $("#lastloadedmarket").val(), 'marketbookname': marketbookname, 'Liablaity': 0, 'BetSize': 0, 'PendingAmount': 0, 'location': 0, 'ParentID': 0,'UserID':cuttinguserid },

            complete: function () {
                $("#btnAdminBet").prop('disabled', false);
            },
            success: function (data) {
                if (data.indexOf("True") >= 0) {
                    //$("#userbets").load('/Market/UserBets');
                    setTimeout(function(){
                        $("#btnAdminBet").prop('disabled', false);
                    },2000);

                    HideLoader();
                }
                else {
                    setTimeout(function(){
                        $("#btnAdminBet").prop('disabled', false);
                    },2000);
                    if (data == "False") {
                        HideLoader();
                        ShowErrorMsg("Something went wrong, please place bet again.");
                    }
                    else {
                        HideLoader();
                        ShowErrorMsg(data);
                    }


                }



            }
        });
    }
    function Loadliabalitiesbymarkets(){
        //  $("#libalitybymarket").html("");
        //  $("#libalitybymarket").show();

        $.ajax({
            type: "GET",
            async:true,
            url: "/Liabality/LoadLiabalitybyMarket",
            success: function (result) {
                // Loadliabalitiesbymarkets();
                $("#libalitybymarket").html(result);


            },
            complete:function(){


            }

        });


    }
    function checkNetConnection(){

        jQuery.ajaxSetup({async:false});
        re="";
        r=Math.round(Math.random() * 10000);
        $.get("http://" + window.location.host + "/Content/Images/Logo.png",{subins:r},function(d){
            re=true;
        }).error(function(){
            re=false;
        });

        return re;
    }

    function insertbetslip() {
        if(checkNetConnection()==false){
            return  ;
        }
        debugger;
        selectionID = $("#openedbetslipid").val();
        $.ajax({
            url: '/UserBet/InsertUserBetNew',

            type: 'POST',
            async: false,
            data: { 'userodd': $("#betslipodd").val(), 'SelectionID': selectionID, 'Selectionname': $("#betslipselection").text(),'BetType': $("#betsliptype").val(), 'nupdownAmount': $("#betslipamount").val(),'betslipamountlabel':$("#betslipamountlabel").text(),'Clickedlocation':$("#clickedlocation").val(),'Betslipsize':$("#betslipsize").text(),'marketbookId': $("#loadedmarketbook").val(), 'Marketbookname': $("#loadedmarketbookname").val() },

            complete: function () {

            },
            success: function (data) {
                HideLoader();





            }
        });






    }
    function setBetslipamountlowerlimit(){
        // var betamounttobeplaced=parseFloat($("#betslipamountmultiple").val().trim());
        var lowerbetlimit= 2000;

        var categoryname=$("#marketbookCategory"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        var marketbookname=$("#marketbookname"+$("#lastloadedmarket").val().toString().replace(".","")).val();
        if (categoryname.indexOf("Horse Racing")>=0 && marketbookname.indexOf("To Be Placed")<0){
            lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimit();

        }
        else{
            if (categoryname.indexOf("Horse Racing")>=0 && marketbookname.indexOf("To Be Placed")>=0){
                lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitHorsePlace();

            }
            else{
                if (categoryname.indexOf("Greyhound Racing")>=0 && marketbookname.indexOf("To Be Placed")>=0){
                    lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitGrayHoundPlace();

                }
                else{
                    if (categoryname.indexOf("Greyhound Racing")>=0 && marketbookname.indexOf("To Be Placed")< 0){
                        lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitGrayHoundWin();

                    }
                    else{
                        if (marketbookname.indexOf("Completed Match")>=0){
                            lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitCompletedMatch();

                        }
                        else{
                            if (marketbookname.indexOf("Innings Runs")>=0 ||marketbookname.indexOf("Inns Runs")>=0){
                                lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitInningsRuns();

                            }
                            else{
                                if(categoryname=="Tennis"){
                                    lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitMatchOddsTennis();

                                }
                                else{
                                    if(categoryname=="Soccer"){
                                        lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitMatchOddsSoccer();

                                    }
                                    else{
                                        if (marketbookname.indexOf("Tied Match")>=0){
                                            lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitTiedMatch();

                                        }
                                        else{
                                            if (marketbookname.indexOf("Winner")>=0){
                                                lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitWinner();

                                            }
                                            else{
                                                lowerbetlimit=@LoggedinUserDetail.GetBetLowerLimitMatchOdds();

                                            }
                                        }

                                    }
                                }

                            }
                        }
                    }
                }
            }
        }
        return lowerbetlimit;
    }
    function setuserbethiddenfieldsvalue(loadedmarketID, userodd, selectionID, amount, selectionname, betsliptype, marketbookname, betslipsize) {
        $("#isBetSlipEdit").val("0");
        $("#loadedmarketbook").val(loadedmarketID);
        $("#betslipodd").val(userodd);
        $("#openedbetslipid").val(selectionID);
        $("#betslipamount").val(amount);
        $("#betslipselection").text(selectionname);
        $("#betsliptype").val(betsliptype);
        $("#betslipsize").text(betslipsize);
        $("#loadedmarketbookname").val(marketbookname);
        calculateamounts();
    }

    function resetamount() {
        debugger;
        isfirstclick=true;
        $("#betslipamount").val('2000');
        $("#betslipamountlabel").html(parseFloat('2000').toFixed(2));
        calculateamounts();
    }
    function resetamountmultiple() {
        isfirstclick=true;
        $("#betslipamountmultiple").val('4000');

        calculateamountsmultiple();
    }
    function SetBackandlayonbetslip(id) {
        var marketbookID = $("#loadedmarketbook").val().toString().replace(".", "");
        var location = $("#loadedbetlocation").val();
        $("#betsliplay").html($("#marketbook"+marketbookID+" #selection" + id + "  .layitem:nth-child(1)").children("label").first().html());
        $("#betslipback").html($("#marketbook"+marketbookID+" #selection" + id + " .backitem:nth-child(3)").children("label").first().html());
        //$("#betsliplay").html($("#lbllayprice" + location + id).text().trim());
        //$("#betslipback").html($("#lblbackprice" + location + id).text().trim());
        if ($("#betsliptype").val() == 'back') {
            $("#betslipsize").html($("#marketbook"+marketbookID+" #selection" + id + " .backitem:nth-child(3)").children("label").last().html());
        }
        else {
            $("#betslipsize").html($("#marketbook"+marketbookID+" #selection" + id + "  .layitem:nth-child(1)").children("label").last().html());
        }
    }
    function calculateamounts() {
	if($("#betslipodd").val().toString().indexOf(".")>=0){
            $("#betslipodd").val(parseFloat($("#betslipodd").val()).toFixed(2));
        }
        var marketbookrunners=$("#marketbookrunners"+$("#loadedmarketbook").val().toString().replace(".", "")).val();
        var odd = $("#betslipodd").val();
        var amount = $("#betslipamount").val();
        $("#betslipamountlabel").html(parseFloat(amount).toFixed(2));
        if(marketbookrunners=="1"){
            $("#betslipoddlabel").html((parseFloat(amount)).toFixed(2));
        }
        else{
            $("#betslipoddlabel").html((parseFloat(odd * amount) - parseFloat(amount)).toFixed(2));
            if ($("#betsliptype").val() == 'lay') {
                var betslipamount = $("#betslipamountlabel").html();
                $("#betslipamountlabel").html($("#betslipoddlabel").html());
                $("#betslipoddlabel").html(betslipamount);
            }
        }

    }
    function calculateamountsmultiple() {

        if ($("#betsliptype").val() == 'lay') {
            var odd = $("#betsliplaymultiple").text();
            odd=parseFloat(odd)+1;
            var amount = $("#betslipamountmultiple").val();
            if (parseFloat(odd) > 0){
                $("#betslipamountlabelmultiple").html((parseFloat(odd * amount) - parseFloat(amount)).toFixed(2));
            }
            else{
                $("#betslipamountlabelmultiple").html("0.00");
            }

            $("#betslipoddlabelmultiple").html(parseFloat(amount).toFixed(2));
        }
        else{
            var odd = $("#betslipbackmultiple").text();
            odd=parseFloat(odd)+1;
            var amount = $("#betslipamountmultiple").val();
            $("#betslipamountlabelmultiple").html(parseFloat(amount).toFixed(2));
            if(parseFloat(odd) > 0){
                $("#betslipoddlabelmultiple").html((parseFloat(odd * amount) - parseFloat(amount)).toFixed(2));
            }
            else{
                $("#betslipoddlabelmultiple").html(("0.00"));
            }

        }
    }
    function LoadRunnername(id) {
        $("#lblSelectionName" + id).text($("#selectionname" + id).val())
    }
    function showbetslip(id, betsliptype, odd, amount, isEdit, marketbookID, marketbookname, betsize, location, parentID)
    {
        if(isInserting==true){
            return;
        }
        $("#isBetSlipEdit").val(isEdit);
        $("#loadedmarketbook").val(marketbookID);
        $("#loadedmarketbookname").val(marketbookname);
        $("#loadedbetlocation").val("");
        $("#clickedlocation").val(location);
        $("#clickedodd").val("");
        $("#clickedbetsize").val("");
        $("#clickedID").val(0);

        // ShowLoader();
        var old = marketbookID.toString();
        var newid = old.replace('.', '');
       
        var marketbookrunners= $("#marketbookrunners" + newid).val();

        var status = $("#marketbookstatus" + newid).html();
        if(marketbookrunners=="1"){
            status=$("#marketbookstatus" + newid).val();
        }
        var allowedstatus=false;
        var timeofmatch=$("#lbltimer"+newid).text();
        var categoryname=$("#marketbookCategory"+newid).val();
        var betttingallowedmarket=$("#marketbookAllowedBetting"+newid).val();
        var betttingallowedmarketoverall=$("#marketbookAllowedBettingOverAll"+newid).val();
       
        if(categoryname=="Cricket" ){
            $.ajax({
                url: '/UserBet/GetBettingAllowedbyMarketIDandUserID',

                type: 'POST',
                async:false,
                data: { 'MarketBookID': marketbookID },

                complete: function () { },
                success: function (data) {
                    debugger;
                    if (data == "True") {
                        $("#marketbookAllowedBetting"+newid).val('1');


                        betttingallowedmarket="1";
                    }
                    else{
                        $("#marketbookAllowedBetting"+newid).val('0');
                        betttingallowedmarket="0";
                    }

                }
            });
        }

debugger;
        if(betttingallowedmarket=="0" || betttingallowedmarketoverall=="0" )
        {
            allowedstatus==false;
			 ShowErrorMsg("Betting not allowed.");
        }
        else
        {
            if (categoryname.indexOf("Racing")>=0)
            {
                if (status=="IN-PLAY"){
                    allowedstatus=true;
                }
                else
                {
				debugger;
                    if (status=="GOING LIVE"){

                        var minutesremaining=timeofmatch.split(":");
                        debugger;
                        if(marketbookname.indexOf("(US)")>=0){
                            if(parseFloat(minutesremaining[0])>=0 && parseFloat(minutesremaining[2]) <= @LoggedinUserDetail.BetPlaceWaitandInterval.RaceMinutesBeforeStart && parseFloat(minutesremaining[1])==0){
                                allowedstatus=true;
                            }
                            else{
                                if(parseFloat(minutesremaining[0])<0){
                                    allowedstatus=true;
                                }
                            }
                        }
                        else{
                            if(parseFloat(minutesremaining[0])>=0 && parseFloat(minutesremaining[2]) <= @LoggedinUserDetail.BetPlaceWaitandInterval.RaceMinutesBeforeStart && parseFloat(minutesremaining[1])==0){
                                allowedstatus=true;
                            }
                            else{
                                if(parseFloat(minutesremaining[0])<0){
                                    allowedstatus=true;
                                }
                            }
                        }
                    }
                }
            }
            else
            {
                if (status=="IN-PLAY" ||status=="IN PLAY" || status=="In Play" ){
                    allowedstatus=true;
                }
				 if (marketbookname.indexOf("Winner")>=0 || marketbookname.indexOf("To Win the Toss")>=0 )
            {
                allowedstatus = true;
            }

            }

            if (  allowedstatus==true) {
                $("#openedbetslipid").val(id);
                $("#betsliptype").val(betsliptype);
                if (betsliptype == 'back') {

                    $("#betslipcontent").css("background-color", "#bddff7");
                    var clothnumber=$("#marketbook"+newid+ " #lblSelectionClothnumber"+id).text().toString().trim();
                    var selectionname = $("#marketbook"+newid+ " #lblSelectionName" + id).text().toString().trim();
                    if(clothnumber!=""){
                        selectionname=clothnumber+"."+selectionname;
                    }
                    $("#betslipheading").html('You are going to back ' + selectionname);
                    $("#betslipselection").html(selectionname);
                    $("#betslipsize").text($("#marketbook"+newid+" #selection" + id + "  .backitem:nth-child(3)").children("label").last().html());

                }
                else {
                    $("#betslipcontent").css("background-color", "#fdbac8");
                    var clothnumber=$("#marketbook"+newid+ " #lblSelectionClothnumber"+id).text().toString().trim();
                    var selectionname = $("#marketbook"+newid+ " #lblSelectionName" + id).text().toString().trim();
                    if(clothnumber!=""){
                        selectionname=clothnumber+"."+selectionname;
                    }
                    $("#betslipheading").html('You are going to lay ' + selectionname);
                    $("#betslipselection").html(selectionname);
                    $("#betslipsize").text($("#marketbook"+newid+" #selection" + id + "  .layitem:nth-child(1)").children("label").last().html());
                }


                $("#betsliplay").html($("#marketbook"+newid+" #selection" + id + "  .layitem:nth-child(1)").children("label").first().html());

                $("#betslipback").html($("#marketbook"+newid+" #selection" + id + "  .backitem:nth-child(3)").children("label").first().html());
                $("#betslipodd").val(parseFloat(odd));

                $("#betslipamount").val(setBetslipamountlowerlimit());
                calculateamounts();
                $('#myModalBetslip').modal('show');
            }
            else 
			{
                ShowErrorMsg("Betting not allowed.");
            }


        }
    }
    function showbetslipmultiple(id, betsliptype, odd, amount, isEdit, marketbookID, marketbookname, betsize, location, parentID)
    {
        if(isInserting==true){
            return;
        }
        $("#isBetSlipEdit").val(isEdit);
        $("#loadedmarketbook").val(marketbookID);
        $("#loadedmarketbookname").val(marketbookname);
        if (marketbookname.indexOf("To Be Placed")>=0){
            ShowErrorMsg("Betting not allowed in multi winner markets.");
            return;
        }
        $("#clickedlocation").val(0);
        var old = marketbookID.toString();
        var newid = old.replace('.', '');
        var selectedrunners= $("#selectedrunners"+newid).val();
        if (selectedrunners !="" )
        {
            selectedrunners = JSON.parse(selectedrunners);
            if (selectedrunners.length>1)
            {


                // ShowLoader();

                var status = $("#marketbookstatus" + newid).html();
                var allowedstatus=false;
                var timeofmatch=$("#lbltimer"+$("#lastloadedmarket").val().toString().replace(".","")).text();
                var categoryname=$("#marketbookCategory"+$("#lastloadedmarket").val().toString().replace(".","")).val();
                var betttingallowedmarket=$("#marketbookAllowedBetting"+$("#lastloadedmarket").val().toString().replace(".","")).val();
                var betttingallowedmarketoverall=$("#marketbookAllowedBettingOverAll"+$("#lastloadedmarket").val().toString().replace(".","")).val();

                if(betttingallowedmarket=="0" || betttingallowedmarketoverall=="0" ){
                    allowedstatus==false;
                }
                else
                {
                    if (categoryname.indexOf("Racing")>=0)
                    {
                        if (status=="IN-PLAY"){
                            allowedstatus=true;
                        }
                        else
                        {
                            if (status=="GOING LIVE"){

                                var minutesremaining=timeofmatch.split(":");
                                debugger;
                                if(marketbookname.indexOf("(US)")>=0){
                                    if(parseFloat(minutesremaining[0])>=0 && parseFloat(minutesremaining[2]) <= @LoggedinUserDetail.BetPlaceWaitandInterval.RaceMinutesBeforeStart && parseFloat(minutesremaining[1])==0){
                                        allowedstatus=true;
                                    }
                                    else{
                                        if(parseFloat(minutesremaining[0])<0){
                                            allowedstatus=true;
                                        }
                                    }
                                }
                                else{
                                    if(parseFloat(minutesremaining[0])>=0 && parseFloat(minutesremaining[2]) <= @LoggedinUserDetail.BetPlaceWaitandInterval.RaceMinutesBeforeStart && parseFloat(minutesremaining[1])==0){
                                        allowedstatus=true;
                                    }
                                    else{
                                        if(parseFloat(minutesremaining[0])<0){
                                            allowedstatus=true;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    else
                    {
                        if (status=="IN-PLAY"){
                            allowedstatus=true;
                        }

                    }

                    if (allowedstatus==true) {

                        $("#betsliptype").val(betsliptype);
                        if (betsliptype == 'back') {

                            $("#betslipcontentmultiple").css("background-color", "#bddff7");
                            $("#betslipheadingmultiple").html('You are going to place back bets ');

                        }
                        else {
                            $("#betslipcontentmultiple").css("background-color", "#fdbac8");
                            $("#betslipheadingmultiple").html('You are going to place lay bets ');

                        }


                        $("#betsliplaymultiple").html($("#lblfavoritelayprice" + newid).text().toString().trim());

                        $("#betslipbackmultiple").html($("#lblfavoritebackprice" + newid).text().toString().trim());
                        amount=parseInt( setBetslipamountlowerlimit()) * 2;
                        $("#betslipamountmultiple").val(amount);
                        calculateamountsmultiple();
                        $('#myModalBetslipmultiple').modal('show');
                    }
                    else {
                        ShowErrorMsg("Betting not allowed.");
                    }
                }


            }
            else
            {
                ShowErrorMsg("Please select atleast two runners.");
            }

        }
        else
        {
            ShowErrorMsg("Please select atleast two runners.");
        }
    }
    function ShowSubmenu() {

        $(".eventtypes").toggle();
        $("#detailsselecteditem").html('');
        $("#inplayul").hide();
        $("#todayhorseraceui").hide();
        $("#inplayul").hide();
        $("#todaygrayhoundraceui").hide();
        // $("#detailsselecteditem").insertAfter($("#sportsitem1"));
        if ($(".eventtypes").css("display") == "none") {

        }
    }
    function addorremovefromfavouriteseventtype(id) {

        var imgsrc = $("#eventtypeitemimg" + id).attr("src");
        var dataurl = "";
        if (imgsrc != "../Content/Images/favoriteChecked.png") {
            dataurl = '/Market/AddtoFavoritesEventType';
        }
        else {
            dataurl = '/Market/RemoveFavoritesEventType'
        }
        $.ajax({
            url: dataurl,

            type: 'POST',

            data: { 'eventtypeID': id },

            complete: function () { },
            success: function (data) {

                if (data == "True") {
                    if (imgsrc != "../Content/Images/favoriteChecked.png") {
                        $("#eventtypeitemimg" + id).attr({ "src": "../Content/Images/favoriteChecked.png", "title": "Remvoe from favorites" });
                    }
                    else {
                        $("#eventtypeitemimg" + id).attr({ "src": "../Content/Images/FavoriteUncheck.png", "title": "Add to favorites" });
                    }
                }


            }
        });
    }

    function LoadCompetitions(id) {

        if ($("#competitions" + id).css("display") == "none") {

            ShowLoader();
            $(".competitions").hide();
            var partialviewname = "/Market/Competiion/" + id;


            $("#competitions" + id).load(partialviewname, function () {
                $("#competitions" + id).show();
                HideLoader();
                $('html,body').animate({ scrollTop: $(this).offset().top - 50 }, 800);
            });

        }
        else {
            $("#competitions" + id).hide();

        }
    }
    function LoadEvents(id) {

        if ($("#Events" + id).css("display") == "none") {

            ShowLoader();
            $(".events").hide();
            var partialviewname = "/Market/Events/" + id;

            //var competitionname = $("#competitionsItem" + id).text();

            //$("#detailsselecteditem").html(" > " + competitionname);

            $("#Events" + id).load(partialviewname, function () {
                $("#Events" + id).show();
                HideLoader();
            });
        }
        else {
            $("#Events" + id).hide();

        }
    }
    function LoadMarketCatalogue(id) {

        if ($("#MarketCatalogue" + id).css("display") == "none") {

            ShowLoader();
            $(".marketcatalogue").hide();
            var partialviewname = "/Market/MarketCatalogue/" + id;
            //var eventname = $("#eventitem" + id).text();
            //var competitionname = $("#detailsselecteditem").html().split("<br>");
            //$("#detailsselecteditem").html($("#detailsselecteditem").html() + " > " + eventname);
            //if(competitionname[1]){
            //    eventname= competitionname[0] +"<br/><span class='breadcrumbeventname'> > "+ eventname + "</span>";
            //    $("#detailsselecteditem").html(eventname);
            //}
            //else{
            //    eventname= $("#detailsselecteditem").html()+"<br/><span class='breadcrumbeventname'> > "+ eventname + "</span>";
            //    $("#detailsselecteditem").html(eventname);
            //}


            $("#MarketCatalogue" + id).load(partialviewname, function () {
                $("#MarketCatalogue" + id).show();
                HideLoader();
            });
        }
        else {
            $("#MarketCatalogue" + id).hide();
            //var competitionname = $("#detailsselecteditem").html().split("<br>");
            //$("#detailsselecteditem").html(competitionname[0]);
        }
    }
    function lastLevelBreadcrumb(id) {

        $(".competitions").hide();
        $(".eventtypes").hide();
        // ShowInPlay();
        $("#lastsavedhtml").val('');
        $("#marketbook").html('');
        $("#todayhorseraceui").hide();
        $("#inplayul").hide();
        $("#todaygrayhoundraceui").hide();
        togglemainsportsmenu(3,"");
        LoadMarketType(id);
        $("#lastloadedmarket").val(id);


    }

    function SetLastLoadedMarket(id) {
        $("#fancymarketbook").html("");
        if($(".nav-tabs li").length > 0){
            $("#lastloadedmarket").val(id);
            SetFirstItemActive(id);
            $(".averagecalculations").html("");
            LoadActiveMarket();
            GetActiveMarketFancy();
        }else{
            $("#lastloadedmarket").val("");
        }
        @*if(@LoggedinUserDetail.GetUserTypeID()==1){
            ShowAverageSection();
    }*@

    }

    function LoadMarketTypeTWT(id) {

        
      
        $("#lastsavedhtmlTWT").val($("div[data-marketid='" + $("#lastloadedmarketTWT").val() + "']").html());
      
       
        $.ajax({
            url: '/Market/MarketBookToWinTheToss/',

            type: 'GET',
            async: true,
            data: { 'ID': id },

            complete: function () {
                HideLoader();
                
            },
            success: function (data) {
                if(data=="Limit exceed"){
                    ShowErrorMsg("You already have opened ten markets please close some markets and try again.");
                    return false;
                }
                else{

                    $("#marketbookTWT").html(data);

                    if ($("#lastsavedhtmlTWT").val().trim() == "") {
                        $("#lastsavedhtmlTWT").val($("#marketbookTWT").html());
                    }
                   // comparemarketbook();

                    //var lastloadedmarket = $("#lastloadedmarket").val().toString();
                    if ($("#lastloadedmarketTWT").val() == "") {
                        $("#lastloadedmarketTWT").val($(".nav-tabs li:last").attr("data-value"));
                    }
                  
                  
                   

                  
                    LoadActiveMarketTWT();
                  
                  
                    
                    var marketbbokname=$("#marketbookname"+$("#lastloadedmarketTWT").val().toString().replace(".","")).val();
                    var marketbookdID= $("#lastloadedmarketTWT").val().toString().replace(".","");
                    var mainsportcat=$("#marketbookCategory"+$("#lastloadedmarketTWT").val().toString().replace(".","")).val();
                    var mainsportrunners=$("#marketbookrunners"+$("#lastloadedmarketTWT").val().toString().replace(".","")).val();
                    $(".checkboxrunnernameavgTWT").slice(0,2).each(function() {
                        debugger;
                        $(this).prop("checked",true);
                        AddRunnersforaveragecalTWT($(this).attr("data-value"));
                    });
                    
                    
                }

                //var isCompleted = $("#marketstatus").val();
                //var isinplay = $("#inplaystatus").val();
                //if (isinplay == "True" && isCompleted == "OPEN") {



                //}


            }
        });


    }
    function LoadMarketType(id) {

        $("#liscorecard").hide();
        // $("#lastsavedhtml").val($("#marketbook").html());
        $("#lastsavedhtml").val($("div[data-marketid='" + $("#lastloadedmarket").val() + "']").html());
        dataurl = '/Market/MarketBook/';
        ShowLoader();
        $.ajax({
            url: '/Market/MarketBook/',

            type: 'GET',
            async: true,
            data: { 'ID': id },

            complete: function () {
                HideLoader();
                
            },
            success: function (data) {
                if(data=="Limit exceed"){
                    ShowErrorMsg("You already have opened ten markets please close some markets and try again.");
                    return false;
                }
                else{

                    $("#marketbook").html(data);

                    if ($("#lastsavedhtml").val().trim() == "") {
                        $("#lastsavedhtml").val($("#marketbook").html());
                    }
                    comparemarketbook();

                    //var lastloadedmarket = $("#lastloadedmarket").val().toString();
                    if ($("#lastloadedmarket").val() == "") {
                        $("#lastloadedmarket").val($(".nav-tabs li:last").attr("data-value"));
                    }
                    SetSelectedRunners();
                    SetFirstItemActive($("#lastloadedmarket").val());
                    $("#activesheetname").val($("#marketbooksheet"+ $("#lastloadedmarket").val().replace(".","")).val());

                    // LoadUserBets();
                    
                    LoadActiveMarket();
                    GetActiveMarketFancy();
                    CheckForCricketScores();
                    var isallowedtogetscore = $("#marketbookgetscores" + $("#lastloadedmarket").val().toString().replace(".", "")).val();
                     var getupdatesfrom= $("#getmatchupdatesfrom" + $("#lastloadedmarket").val().toString().replace(".", "")).val();
                    if (isallowedtogetscore == "true" && getupdatesfrom=="Other") {
                        $("#liscorecard").show();
                    }
                    var marketbbokname=$("#marketbookname"+$("#lastloadedmarket").val().toString().replace(".","")).val();
                    var marketbookdID= $("#lastloadedmarket").val().toString().replace(".","");
                    var mainsportcat=$("#marketbookCategory"+$("#lastloadedmarket").val().toString().replace(".","")).val();
                    var mainsportrunners=$("#marketbookrunners"+$("#lastloadedmarket").val().toString().replace(".","")).val();

                    if (marketbbokname.indexOf("Match Odds")>=0 && mainsportcat.indexOf("Cricket")>=0 && mainsportrunners=="3" ){
                        $(".checkboxrunnernameavg").show();
                       
                    }
                    $("#marketbookTWT").hide();
                    if (marketbbokname.indexOf("Match Odds")>=0 && mainsportcat.indexOf("Cricket")>=0 && parseInt( mainsportrunners)>=2 ){
                        CheckForWintTheTossMarket();
                        $(".checkboxrunnernameavg").slice(0,2).each(function() {
                            debugger;
                            $(this).prop("checked",true);
                            AddRunnersforaveragecal($(this).attr("data-value"));
                        });
                    }
                }

                //var isCompleted = $("#marketstatus").val();
                //var isinplay = $("#inplaystatus").val();
                //if (isinplay == "True" && isCompleted == "OPEN") {



                //}


            }
        });


    }
    //function updatematchbetstatus(divid, amount, unmatchitemid) {
    //    var selectionid = $(divid).attr("data-selectionid");
    //    var odd = $(divid).attr("data-odd");
    //    // var amount = parseInt($(divid).attr("data-amount"));
    //    var bettype = $(divid).attr("data-bettype");
    //    var ID = $(divid).attr("data-id");
    //    var userbetsize = $(divid).attr("data-betsize");

    //    var ParentbetID = $(divid).attr("data-parentID");
    //    var classselctor = "";

    //    if (bettype == 'back') {
    //        classselctor = " .backitem";
    //    } else {
    //        classselctor = " .layitem";
    //    }
    //    $("#selection" + selectionid + classselctor).each(function () {

    //        var liveodd = $(this).children("label").first().html().trim();
    //        var betsize = parseInt($(this).children("label").last().html().trim());
    //        // var parentbetsize = $("#lblbetamount" + ParentbetID).html().trim();


    //        if (liveodd == odd) {

    //            if (userbetsize != betsize) {

    //                if (betsize >= amount) {
    //                    deleteuserbet(unmatchitemid);
    //                    UpdateamountbyID(ID, amount, true);

    //                    newamount = 0;
    //                    return newamount;
    //                }
    //                else {
    //                    newamount = amount - betsize;
    //                    UpdateamountbyID(ID, betsize, true);
    //                    UpdateamountbyID(unmatchitemid, -1 * betsize, false);
    //                    return newamount;

    //                }

    //            }



    //        }



    //    });
    //}

    function comparemarketbook() {
        var marketbookID=$("#lastloadedmarket").val().toString().replace(".","");
        var oldmarketbook = $("#lastsavedhtml").val();
        $("div[data-marketid='" + $("#lastloadedmarket").val() + "']").html()
        var newmarketbook = $("div[data-marketid='" + $("#lastloadedmarket").val() + "']").html()
        // var newmarketbook = $("#marketbook").html();
        //var oldpricesandsize = $(oldmarketbook).find(".priceandsize").find("label");
        //var newpricesandsize = $(newmarketbook).find(".priceandsize").find("label");
        var oldpricesandsize = $(oldmarketbook).find(".matchcolors").find("label");
        var newpricesandsize = $(newmarketbook).find(".matchcolors").find("label");

        for (i = 0; i <= oldpricesandsize.length - 1; i++) {
            if (i < newpricesandsize.length) {
                var oldvalue = $(oldpricesandsize[i]).html();
                var newvalue = $(newpricesandsize[i]).html();
                if (oldvalue != newvalue) {

                    var id = $(newpricesandsize[i]).attr("id");

                    $("#marketbook"+marketbookID+ " #" + id).addClass("highlighted").delay(100).queue(function () {
                        $(this).removeClass("highlighted").dequeue();
                    });;
                }
            }

        }
    }
$('#btnPlay').click(function (ev){
				$("#video")[0].src = "http://139.162.20.164/btv.html?c="+eventID+"";
				$("#video").show();
			})
    $('#tv2').click(function (ev){
        $('#ftv1').modal('hide'); 
        $('#ftv2').modal('show'); 
        $('#ftv3').modal('hide'); 
    })
    $('#tv3').click(function (ev){
        $('#ftv1').modal('hide'); 
        $('#ftv2').modal('hide'); 
        $('#ftv3').modal('show'); 
    })
    function comparemarketbookTWT() {
        var marketbookID=$("#lastloadedmarketTWT").val().toString().replace(".","");
        var oldmarketbook = $("#lastsavedhtmlTWT").val();
        $("div[data-marketid='" + $("#lastloadedmarketTWT").val() + "']").html()
        var newmarketbook = $("div[data-marketid='" + $("#lastloadedmarketTWT").val() + "']").html()
        // var newmarketbook = $("#marketbook").html();
        //var oldpricesandsize = $(oldmarketbook).find(".priceandsize").find("label");
        //var newpricesandsize = $(newmarketbook).find(".priceandsize").find("label");
        var oldpricesandsize = $(oldmarketbook).find(".matchcolors").find("label");
        var newpricesandsize = $(newmarketbook).find(".matchcolors").find("label");

        for (i = 0; i <= oldpricesandsize.length - 1; i++) {
            if (i < newpricesandsize.length) {
                var oldvalue = $(oldpricesandsize[i]).html();
                var newvalue = $(newpricesandsize[i]).html();
                if (oldvalue != newvalue) {

                    var id = $(newpricesandsize[i]).attr("id");

                    $("#marketbook"+marketbookID+ " #" + id).addClass("highlighted").delay(100).queue(function () {
                        $(this).removeClass("highlighted").dequeue();
                    });;
                }
            }

        }
    }

    var newamount = 0;


</script>
<link href="~/Content/bootstrap-submenu.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap-submenu.js"></script>
<script src="~/Scripts/DetectChanges.js"></script>
